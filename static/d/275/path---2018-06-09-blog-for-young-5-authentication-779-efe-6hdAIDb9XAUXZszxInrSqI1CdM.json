{"data":{"site":{"siteMetadata":{"title":"Joel's dev blog","author":"Joel Mun","siteUrl":"https://9oelm.github.io"}},"markdownRemark":{"id":"686930f2-24b5-594d-951b-11da0ef43cff","excerpt":"References medium post zerocho webframeworks post next.js discussion on login And I even found this:  authentication library for nextjs \n“connect-mongo”: “^2.…","html":"<h2>References</h2>\n<ul>\n<li><a href=\"https://medium.com/of-all-things-tech-progress/starting-with-authentication-a-tutorial-with-node-js-and-mongodb-25d524ca0359\">medium post</a></li>\n<li><a href=\"https://medium.com/of-all-things-tech-progress/starting-with-authentication-a-tutorial-with-node-js-and-mongodb-25d524ca0359\">zerocho</a></li>\n<li><a href=\"http://webframeworks.kr/tutorials/expressjs/auth_log_in_out/\">webframeworks post</a></li>\n<li><a href=\"https://github.com/zeit/next.js/issues/153\">next.js discussion on login</a></li>\n</ul>\n<p>And I even found this: </p>\n<ul>\n<li>\n<p><a href=\"https://github.com/iaincollins/next-auth\">authentication library for nextjs</a>\n“connect-mongo”: “^2.0.1”,\n“dotenv”: “^5.0.1”,\n“express-session”: “^1.15.6”,\n“mongodb”: “^3.0.7”,\n“nedb”: “^1.8.0”,\n“next”: “^6.0.0”,\n“next-auth”: “^1.8.5”,\n“nodemailer”: “^4.6.4”,\n“nodemailer-direct-transport”: “^3.3.2”,\n“nodemailer-smtp-transport”: “^2.7.4”,\n“passport-facebook”: “^2.1.1”,\n“passport-google-oauth”: “^1.0.0”,\n“passport-twitter”: “^1.0.4”,</p>\n<h2>Install things</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save next-auth connect-mongo dotenv express-session mongodb nedb nodemailer nodemailer-direct-transport nodemailer-smtp-transport poassport-facebook passport-google-oauth passport-twitter</code></pre></div>\n</li>\n</ul>\n<h3>1. Create <code class=\"language-text\">index.js</code> and paste the following in</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Include Next.js, Next Auth and a Next Auth config</span>\n<span class=\"token keyword\">const</span> next <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'next'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> nextAuth <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'next-auth'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> nextAuthConfig <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./next-auth.config'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Load environment variables from .env</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Initialize Next.js</span>\n<span class=\"token keyword\">const</span> nextApp <span class=\"token operator\">=</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  dir<span class=\"token punctuation\">:</span> <span class=\"token string\">'.'</span><span class=\"token punctuation\">,</span>\n  dev<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'development'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Add next-auth to next app</span>\nnextApp\n<span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Load configuration and return config object</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">nextAuthConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>nextAuthOptions <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Pass Next.js App instance and NextAuth options to NextAuth</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">nextAuth</span><span class=\"token punctuation\">(</span>nextApp<span class=\"token punctuation\">,</span> nextAuthOptions<span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// port 8080 for c9.io</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`Ready on http://localhost:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">8080</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'An error occurred, unable to start the server'</span><span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>2. edit <code class=\"language-text\">package.json</code> like this</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string\">\"scripts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"dev\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"NODE_ENV=development node index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"build\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"next build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"next start\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h3>3. Create new files</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">j031:~/workspace (add2-adminPage) $ tree . -L 3 -I node_modules                                \n.\n├── README.md\n├── components\n│   ├── article.js\n│   ├── copyright.js\n│   ├── fixedHeading\n│   │   ├── fakeButton.js\n│   │   ├── fixedHeadingLayout.js\n│   │   ├── menuButton.js\n│   │   └── title.js\n│   ├── footer.js\n│   ├── header.js\n│   ├── layout.js\n│   ├── mainContent\n│   │   ├── mainContent.js\n│   │   └── mainContentLayout.js\n│   ├── misc\n│   │   └── sidebar.js\n│   └── slideMenu.js\n├── index.js\n├── next-auth-config.js ---------------------&gt; This\n├── next-auth.functions.js ---------------------&gt; This\n├── next-auth.providers.js ---------------------&gt; This\n├── next.config.js\n├── note\n├── package.json --------------------&gt; this (only npm run dev)\n├── pages\n│   ├── _document.js\n│   ├── _error.js\n│   ├── auth ---------------------&gt; This\n│   │   ├── callback.js ---------------------&gt; This\n│   │   ├── check-email.js ---------------------&gt; This\n│   │   ├── error.js ---------------------&gt; This\n│   │   └── index.js ---------------------&gt; This\n│   ├── cyadmin.js\n│   └── index.js\n└── styles\n    ├── font.sass\n    ├── grommet-button-fix.scss\n    ├── grommet-dxc.min.scss\n    ├── grommet-heading-fix.sass\n    ├── master.sass\n    ├── menu-button-responsive-fix.sass\n    └── react-burger-menu-custom-style.scss\n\n7 directories, 36 files</code></pre></div>\n<h3>4. Just copy the contents of the files from the repository into the corresponding files newly created.</h3>\n<h3>5. Write <code class=\"language-text\">.eslintignore</code> at your root directory</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">next-auth*\n/home/ubuntu/workspace/index.js\n/home/ubuntu/workspace/pages/_error.js\nauth</code></pre></div>\n<p>you do this because <code class=\"language-text\">next build</code> will crash because of the chained output from eslint. For some reason, it will crash if there is any output from eslint. As a temporary tweak, just disable eslint or prevent output from eslint during build.</p>\n<h3>6. Install <code class=\"language-text\">mongodb-org</code> just for c9…</h3>\n<p>Yeah. It cannot support <code class=\"language-text\">mongod</code> for some reason. So do:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt-get install -y mongodb-org</code></pre></div>\n<p>And follow additional steps here:\n<a href=\"https://community.c9.io/t/setting-up-mongodb/1717\">C9’s explanation on how to run mongodb on c9.io</a></p>\n<h3>7. Run <code class=\"language-text\">mongod</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./mongod --httpinterface\n\nthis is equivalent to:\n\nmongod --bind_ip=$IP --dbpath=data --nojournal --rest --httpinterface &quot;$@&quot;\n\nbecause in the step 6, you do:\n\nmongod --bind_ip=$IP --dbpath=data --nojournal --rest &quot;$@&quot; &gt; mongod \n\nfor c9&#39;s specific environment.  </code></pre></div>\n<h3>8. Launch up with <code class=\"language-text\">node index.js</code> from your root directory (I found that <code class=\"language-text\">NODE_ENV=development node index.js</code> does not work for some reason)</h3>\n<h3>9. Browse <code class=\"language-text\">/auth</code></h3>\n<p>Now you can see the <code class=\"language-text\">auth</code> page!\nThe only thing you have to do now is to customize. </p>\n<p><img src=\"https://i.imgur.com/x08iynD.jpg\" alt=\"Browse /auth\"></p>\n<h3>10. Add oAuth</h3>","frontmatter":{"title":"Blog for Young (4): Authentication","date":"June 09, 2018"}}},"pageContext":{"slug":"/2018-06-09--Blog-for-Young-(5):-Authentication/","previous":{"fields":{"slug":"/2018-06-07--Blog-for-Young-(3):-More-troubleshooting/"},"frontmatter":{"title":"Blog for Young (2): More troubleshooting"}},"next":{"fields":{"slug":"/2018-06-09--Blog-for-Young-(4):-Lifting-it-up-with-tests/"},"frontmatter":{"title":"Blog for Young (3): Lifting it up with tests"}}}}