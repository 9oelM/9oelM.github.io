{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog","author":"Kyle Mathews"}},"markdownRemark":{"id":"660be6a5-8586-560a-a891-574a79d64ddb","excerpt":"The problem So I have been building the app  Youtube-Lite , and I finally have faced the moment where I need asynchronous function working with  . So I had to…","html":"<h1>The problem</h1>\n<p>So I have been building the app <a href=\"https://github.com/9oelM/Youtube-Lite\">Youtube-Lite</a>, and I finally have faced the moment where I need asynchronous function working with <code class=\"language-text\">redux</code>. So I had to dig into this. </p>\n<h2>Ref</h2>\n<p>I mainly referred to the articles from <a href=\"https://redux.js.org/advanced/asyncactions\">redux.js.org</a> for this post. </p>\n<p>… and, also <a href=\"https://velopert.com/3401\">velopert’s blog</a>.</p>\n<h2>So what the heck is <code class=\"language-text\">redux-thunk</code></h2>\n<h3>It’s a <strong>middleware</strong></h3>\n<p>A middleware is like a bridge from action to reducer.\nYou can do additional things in between them, such as <a href=\"https://github.com/evgenyrodionov/redux-logger\">logging</a>.</p>\n<p>How do you add a middleware to your react-redux application? Like this, using <code class=\"language-text\">applyMiddleware</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createStore<span class=\"token punctuation\">,</span> applyMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span>\n<span class=\"token keyword\">import</span> reducers <span class=\"token keyword\">from</span> <span class=\"token string\">'../reducers/index'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'my-middleware'</span>\n\n<span class=\"token keyword\">const</span> mw <span class=\"token operator\">=</span> <span class=\"token function\">createMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>reducers<span class=\"token punctuation\">,</span> <span class=\"token function\">applyMiddleware</span><span class=\"token punctuation\">(</span>mw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> store<span class=\"token punctuation\">;</span></code></pre></div>\n<p>And so obviously, as we could expect, <code class=\"language-text\">redux-thunk</code> is a type of middleware as well. </p>\n<h3><code class=\"language-text\">redux-thunk</code></h3>\n<p>Well, <a href=\"https://github.com/reduxjs/redux-thunk#whats-a-thunk\">a thunk is a function that wraps an expression to delay its evaluation</a>.</p>\n<p>So <code class=\"language-text\">redux-thunk</code> allows some kind of data from an asynchronous operation or the asynchronous operation itself to be made use of with <code class=\"language-text\">redux</code>.</p>\n<h2>Let’s apply this to my app</h2>\n<h3>1. Apply middleware in <code class=\"language-text\">store/index.js</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm --save-dev install redux-thunk</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createStore<span class=\"token punctuation\">,</span> applyMiddleware <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span>\n<span class=\"token keyword\">import</span> thunk <span class=\"token keyword\">from</span> <span class=\"token string\">'redux-thunk'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> reducers <span class=\"token keyword\">from</span> <span class=\"token string\">'../reducers/reducers'</span>\n\n<span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>\n  reducers<span class=\"token punctuation\">,</span> <span class=\"token function\">applyMiddleware</span><span class=\"token punctuation\">(</span>thunk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  window<span class=\"token punctuation\">.</span>__REDUX_DEVTOOLS_EXTENSION__ <span class=\"token operator\">&amp;&amp;</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">__REDUX_DEVTOOLS_EXTENSION__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> store</code></pre></div>\n<h3>2. Get reducers right according to the asynchronous actions (<code class=\"language-text\">REQUEST_SEARCH</code> and <code class=\"language-text\">RECEIVE_SEARCH</code>)</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> combineReducers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">REQUEST_SEARCH</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">RECEIVE_SEARCH</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">TOGGLE_DRAWER</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../actions/constants'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">viewReducer</span><span class=\"token punctuation\">(</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  isDrawerOpen<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">TOGGLE_DRAWER</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n        isDrawerOpen<span class=\"token punctuation\">:</span> <span class=\"token operator\">!</span>state<span class=\"token punctuation\">.</span>isDrawerOpen<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">return</span> state\n    <span class=\"token comment\">/*\n        It's important to return the previous state for any unknown action.\n        */</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">searchReducer</span><span class=\"token punctuation\">(</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  searchResults<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// nothing is received as a result yet</span>\n  isFetching<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  searchWord<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// return new objects instead of modifying them</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">REQUEST_SEARCH</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n        isFetching<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        searchWord<span class=\"token punctuation\">:</span> action<span class=\"token punctuation\">.</span>searchWord\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">RECEIVE_SEARCH</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n        isFetching<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        searchResults<span class=\"token punctuation\">:</span> action<span class=\"token punctuation\">.</span>searchResults\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">return</span> state\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> rootReducer <span class=\"token operator\">=</span> <span class=\"token function\">combineReducers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  viewReducer<span class=\"token punctuation\">,</span>\n  searchReducer\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> rootReducer</code></pre></div>\n<h3>3. Create thunk action creator!</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token constant\">C</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./constants'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">requestSearch</span> <span class=\"token operator\">=</span> searchWord <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REQUEST_SEARCH</span><span class=\"token punctuation\">,</span>\n  searchWord<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">receiveSearch</span> <span class=\"token operator\">=</span> searchResults <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RECEIVE_SEARCH</span><span class=\"token punctuation\">,</span>\n  searchResults<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">toggleDrawer</span> <span class=\"token operator\">=</span> isDrawerOpen <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> <span class=\"token constant\">C</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TOGGLE_DRAWER</span><span class=\"token punctuation\">,</span>\n  isDrawerOpen<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Thunk action creator</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchSearchResults</span><span class=\"token punctuation\">(</span>searchWord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>dispatch<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">requestSearch</span><span class=\"token punctuation\">(</span>searchWord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">/*\n      your code for requesting the search results\n      that would return searchResults. (fetch, ajax, whatever)\n    */</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">receiveSearch</span><span class=\"token punctuation\">(</span>searchResults<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you see, we now have this thunk action creator which would have <code class=\"language-text\">dispatch</code> function inside, so that you could dispatch actions internally whenever you want to based on situations. </p>","frontmatter":{"title":"Using redux-thunk","date":"Invalid date","description":null}}},"pageContext":{"slug":"/2018-07-29--Using-redux-thunk/","previous":{"fields":{"slug":"/2018-07-25--Migrating-from-Jekyll-to-Gatsby/"},"frontmatter":{"title":"Migrating from Jekyll to Gatsby"}},"next":{"fields":{"slug":"/2018-08-11--Page-transition-in-React/"},"frontmatter":{"title":"Page transition in React"}}}}