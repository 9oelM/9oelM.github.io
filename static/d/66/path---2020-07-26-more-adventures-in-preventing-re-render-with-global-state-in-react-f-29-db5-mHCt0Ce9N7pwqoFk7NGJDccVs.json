{"data":{"site":{"siteMetadata":{"title":"Joel's dev blog","author":"Joel Mun","siteUrl":"https://9oelm.github.io"}},"markdownRemark":{"id":"c0a0fe75-2db5-5426-b9e1-29fe08ab1ac9","excerpt":"Chrome’s performance tab is overwhelming First time you look into all the charts, you have no idea what means what. It’s not self-explanatory. There needs to be…","html":"<h1>Chrome’s performance tab is overwhelming</h1>\n<p>First time you look into all the charts, you have no idea what means what. It’s not self-explanatory. There needs to be a guidebook.</p>\n<p>In this article, I will briefly walk you through all functionalities of Chrome’s performance tab.</p>\n<h2>A very simple example to make it slow</h2>\n<p>I created a simple combination of React components that render quite slowly:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">const</span> itemStyle <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  backgroundColor<span class=\"token punctuation\">:</span> <span class=\"token string\">'grey'</span><span class=\"token punctuation\">,</span>\n  width<span class=\"token punctuation\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\n  height<span class=\"token punctuation\">:</span> <span class=\"token string\">'20px'</span><span class=\"token punctuation\">,</span>\n  marginBottom<span class=\"token punctuation\">:</span> <span class=\"token string\">'2px'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Item</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> number <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>article style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>itemStyle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>number<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>article<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> longListStyle <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  backgroundColor<span class=\"token punctuation\">:</span> <span class=\"token string\">'green'</span><span class=\"token punctuation\">,</span>\n  marginTop<span class=\"token punctuation\">:</span> <span class=\"token string\">'1000px'</span><span class=\"token punctuation\">,</span>\n  padding<span class=\"token punctuation\">:</span> <span class=\"token string\">'5px'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> buttonStyle <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  position<span class=\"token punctuation\">:</span> <span class=\"token string\">'fixed'</span><span class=\"token punctuation\">,</span>\n  top<span class=\"token punctuation\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span>\n  right<span class=\"token punctuation\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span>\n  width<span class=\"token punctuation\">:</span> <span class=\"token string\">'100px'</span><span class=\"token punctuation\">,</span>\n  height<span class=\"token punctuation\">:</span> <span class=\"token string\">'100px'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">generateRandomString</span><span class=\"token punctuation\">(</span>length<span class=\"token punctuation\">,</span> chars<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> length<span class=\"token punctuation\">;</span> i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">--</span>i<span class=\"token punctuation\">)</span> result <span class=\"token operator\">+=</span> chars<span class=\"token punctuation\">[</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> chars<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">generateManyRandomThings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> Array<span class=\"token punctuation\">.</span><span class=\"token keyword\">from</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">4500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.5</span> <span class=\"token operator\">?</span> \n            <span class=\"token function\">generateRandomString</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> \n            Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100000</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> \n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">LongList</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>clickCount<span class=\"token punctuation\">,</span> setClickCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>randomThings<span class=\"token punctuation\">,</span> setRandomThings<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">generateManyRandomThings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setClickCount</span><span class=\"token punctuation\">(</span>clickCount <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setRandomThings</span><span class=\"token punctuation\">(</span><span class=\"token function\">generateManyRandomThings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>button style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>buttonStyle<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleClick<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token string\">`reload (clickCount: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>clickCount<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)`</span></span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>section style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>longListStyle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>randomThings<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n          <span class=\"token operator\">&lt;</span>Item key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token string\">`item-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>idx<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">}</span> number<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>num<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>section<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And it’s showing me this, which is full of 4500 rows of <code class=\"language-text\">&lt;Item /&gt;</code>s:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ad885cad6e07eba81bcef4015acdac3e/7911a/slow-example.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 23.789692868297763%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAnElEQVQY02P4DwT//v37jwz+/PkDprfu2/w/Ijnsf3Zx5v/47Jj/F66dg8j/hciD9MH0fv78+f+3b9/+M+AzcMveTf/DE0P/ZxVl/E/Mjft/8fp5nAa+f//+/9evX/EbuHUfyMCQ/4WV+f8zSlIwXAgDMP1///4l7MKIJIgL47Ki/5+/it3LMP0gffhdCPVyWl7K/5iMSKwuRDcQAMziaxaY9jWhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"slow render example\"\n        title=\"\"\n        src=\"/static/ad885cad6e07eba81bcef4015acdac3e/40fad/slow-example.png\"\n        srcset=\"/static/ad885cad6e07eba81bcef4015acdac3e/707e9/slow-example.png 148w,\n/static/ad885cad6e07eba81bcef4015acdac3e/649e0/slow-example.png 295w,\n/static/ad885cad6e07eba81bcef4015acdac3e/40fad/slow-example.png 590w,\n/static/ad885cad6e07eba81bcef4015acdac3e/b3fef/slow-example.png 885w,\n/static/ad885cad6e07eba81bcef4015acdac3e/301c0/slow-example.png 1180w,\n/static/ad885cad6e07eba81bcef4015acdac3e/b5a53/slow-example.png 1770w,\n/static/ad885cad6e07eba81bcef4015acdac3e/7911a/slow-example.png 1921w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>Finding which part is slow</h2>\n<h3>Prerequisites</h3>\n<ul>\n<li>Go to <code class=\"language-text\">performance</code> tab, and select any of 2x, 4x or 6x slowdown from <code class=\"language-text\">CPU</code> tab to make performance issue even more palpable in Chrome developer tools.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bbcf5a79af02eb81d0cd082e98ac006c/81265/perf-0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 19.827586206896548%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAx0lEQVQY022NS27CQBBEfRNL2GbGnk/PHxwiEaIIATdgzZ6rcOSibbNAIounUnVXd1W/f0dYFxDzBs4nxMQaMnxkHEEpjUEZlO1u3hFnLbnlhv1gCKQJ3kdol1AdTxekMiJvvpDyFoYClPGQg4G1BG0c+4VpF8s30riHogzRa/TKQk5wXipCtf85zI0+RG4JcM6D2AvZoxMS6zeElNhdbrjeHxjPN7Tdes4J0b9UoiqloK5rNE2DZrValGnb9pPXfDrs+Nl/mSctrHsx/b/vqQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Go to `performance` tab, and select any of 2x, 4x or 6x slowdown from `CPU` tab\"\n        title=\"\"\n        src=\"/static/bbcf5a79af02eb81d0cd082e98ac006c/40fad/perf-0.png\"\n        srcset=\"/static/bbcf5a79af02eb81d0cd082e98ac006c/707e9/perf-0.png 148w,\n/static/bbcf5a79af02eb81d0cd082e98ac006c/649e0/perf-0.png 295w,\n/static/bbcf5a79af02eb81d0cd082e98ac006c/40fad/perf-0.png 590w,\n/static/bbcf5a79af02eb81d0cd082e98ac006c/b3fef/perf-0.png 885w,\n/static/bbcf5a79af02eb81d0cd082e98ac006c/81265/perf-0.png 928w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>Install <a href=\"https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en\">React devtools</a></li>\n<li>Disable all Chrome extensions except React Devtools\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1852a9b51ebf9577b96ba10cdd5854c6/ab5f6/disable-all.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 203px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 19.21182266009852%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAABDUlEQVQY0z2QSUoDURCG+yIxQU3Pw+s39RRaiRkcSJSE4AHESLyAi9DgAQIBN24Elwo5ghtzAu/hJf6ULWRRFI/631f/X4Zl+7AcH6bt4bjtwPUiSJ1DqAxRrMBlWr9DJhFGErHQOB/c4HZyh1jqvZZTZcUJjGbrCI1GCxYBJ9MZTIugPkOn7GK9fsHl1TUtDPDxucGyqtA2Nb7ft/jd/mA8WIBJjtF4WkOTtPMPPGgektBBrz+sexAJpHmJ+cMjytNe7W5ZPeN+voDtK7w+veFrtUG3nJEzheHFCIKcKp3BCOlzyARBOGw3BKOYUhf1RjeIKWIClRRw6BRewGmWIuIFmDijyHKv/Sud5NgBEHKL80SVF9MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Disable all\"\n        title=\"\"\n        src=\"/static/1852a9b51ebf9577b96ba10cdd5854c6/ab5f6/disable-all.png\"\n        srcset=\"/static/1852a9b51ebf9577b96ba10cdd5854c6/d001a/disable-all.png 148w,\n/static/1852a9b51ebf9577b96ba10cdd5854c6/ab5f6/disable-all.png 203w\"\n        sizes=\"(max-width: 203px) 100vw, 203px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<h3>Using Chrome’s ‘Performance’ tab</h3>\n<p>Most important things to know:</p>\n<ol>\n<li>The ‘red’ part</li>\n</ol>\n<h2>Making the slow part fast: Redux-wise (may include usage of <code class=\"language-text\">Context</code> for some cases)</h2>\n<ol start=\"2\">\n<li>\n<p>‘Timings’ tab</p>\n</li>\n<li>\n<p>‘Main’ tab</p>\n</li>\n<li>\n<p>Pro tip: do not move around with your mouse. Use W, S, A, D to zoom in and out and move left and right.</p>\n</li>\n<li>\n<p>‘Frames’ tab</p>\n</li>\n<li>\n<p>Use <code class=\"language-text\">useSelector</code> in a better way</p>\n</li>\n<li>\n<p>Batch multiple actions into one action that triggers one update</p>\n</li>\n</ol>\n<h2>Making the slow part fast: React-wise</h2>\n<h1>More resources</h1>\n<ul>\n<li>\n<p><a href=\"https://reactjs.org/docs/optimizing-performance.html#profiling-components-with-the-chrome-performance-tab\">React official docs: Optimizing performance</a></p>\n</li>\n<li>\n<p><a href=\"https://calibreapp.com/blog/react-performance-profiling-optimization\">Profiling React Performance with React 16 and Chrome DevTools.</a></p>\n</li>\n<li>\n<p><a href=\"https://developers.google.com/web/updates/2015/03/devtools-timeline-now-providing-the-full-story\">Paint op</a></p>\n</li>\n<li>\n<p><a href=\"https://scotch.io/courses/10-web-performance-audit-tips-for-your-next-billion-users-in-2018/fmp-first-meaningful-paint#:~:text=Coined%20by%20Google%2C%20First%20Meaningful,to%20appear%20on%20the%20screen.&#x26;text=First%20Contentful%20Paint%20is%20the,painted%20for%20the%20first%20time.\">FMP: First Meaningful Paint</a></p>\n</li>\n<li>\n<p><a href=\"https://web.dev/cls/\">Layout shift</a></p>\n</li>\n<li>\n<p><a href=\"https://developers.google.com/web/updates/2018/09/inside-browser-part3#raster_and_composite_off_of_the_main_thread\">Raster and composite in different threads</a></p>\n</li>\n<li>\n<p><a href=\"https://chromium.googlesource.com/chromium/src.git/+/master/docs/how_cc_works.md\">How Content collator (or… Chromium Compositor) works</a></p>\n</li>\n<li>\n<p><a href=\"https://developers.google.com/web/updates/2018/09/inside-browser-part3#compositing\">Compositing</a></p>\n</li>\n<li>\n<p><a href=\"https://developers.google.com/web/fundamentals/performance/rendering/\">Rendering performance overview</a></p>\n</li>\n<li>\n<p><a href=\"https://bambielli.com/til/2016-02-24-self-time-total-time/\">Self time vs Total time</a></p>\n</li>\n</ul>","frontmatter":{"title":"Do not be afraid to understand what's inside Chrome's Performance tab anymore","date":"August 03, 2020"}}},"pageContext":{"slug":"/2020-07-26--More-adventures-in-preventing-re-render-with-global-state-in-React/","previous":{"fields":{"slug":"/2020-07-29--100BooksProject-(5):초격차(The-Great-Gap)/"},"frontmatter":{"title":"100BooksProject: (5): 초격차 (The Great Gap)"}},"next":null}}