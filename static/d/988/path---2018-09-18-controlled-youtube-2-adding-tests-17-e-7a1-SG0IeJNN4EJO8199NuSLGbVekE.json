{"data":{"site":{"siteMetadata":{"title":"Joel's dev blog","author":"Joel Mun"}},"markdownRemark":{"id":"c24ca5fd-0004-52bc-8c2e-d26fafbf7c5c","excerpt":"So… I’ve done some works on this project, and now the project looks like this: Now I need to go onto component testing with jest & enzyme, but I know nothing…","html":"<p>So… I’ve done some works on this project, and now the project looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── README.md  ---------------------&gt; readme file\n├── config-overrides.js ------------&gt; overrides config on create-react-app\n├── coverage -----------------------&gt; test coverage report\n│   ├── clover.xml\n│   ├── coverage-final.json\n│   ├── lcov-report\n│   │   ├── base.css\n│   │   ├── block-navigation.js\n│   │   ├── index.html\n│   │   ├── prettify.css\n│   │   ├── prettify.js\n│   │   ├── sort-arrow-sprite.png\n│   │   ├── sorter.js\n│   │   └── src\n│   │       ├── App.js.html\n│   │       ├── actions\n│   │       ├── components\n│   │       ├── index.html\n│   │       ├── index.js.html\n│   │       ├── layout\n│   │       ├── modules\n│   │       ├── pages\n│   │       ├── reducers\n│   │       ├── registerServiceWorker.js.html\n│   │       └── store\n│   └── lcov.info\n├── gulpfile.js -------------------&gt; gulpfile for project automation\n├── package-lock.json \n├── package.json \n├── public ------------------------&gt; default create-react-app folder\n│   ├── favicon.ico\n│   ├── index.html\n│   └── manifest.json\n└── src\n    ├── App.js --------------------&gt; the app\n    ├── __test__ ------------------&gt; test scripts, not yet done\n    │   ├── App.test.js\n    │   ├── actions\n    │   ├── components\n    │   │   └── Drawer\n    │   ├── layout\n    │   ├── modules\n    │   └── reducers\n    │       └── reducers.test.js\n    ├── actions -------------------&gt; redux actions \n    │   ├── constants.js\n    │   └── index.js\n    ├── components ----------------&gt; react components\n    │   ├── BottomNav\n    │   ├── Containers\n    │   │   └── index.js\n    │   ├── Drawer\n    │   │   ├── Drawer.js\n    │   │   └── DrawerItems.js\n    │   ├── SearchResult\n    │   │   ├── SearchResultCard.js\n    │   │   └── SearchResultPanel.js\n    │   ├── SideMenu\n    │   ├── TopNav\n    │   │   └── TopNav.js\n    │   └── VideoPlayer\n    │       ├── VideoPlayer.js\n    │       └── VideoPlayerPanel.js\n    ├── index.js ------------------&gt; entry point for everything\n    ├── layout\n    │   ├── contentPage.js\n    │   └── default.js\n    ├── modules\n    │   └── resize.js\n    ├── pages\n    │   ├── About.js\n    │   ├── Home.js\n    │   ├── SearchResultView.js\n    │   ├── Settings.js\n    │   └── VideoPlayerView.js\n    ├── reducers ------------------&gt; redux reducers\n    │   └── reducers.js\n    ├── registerServiceWorker.js --&gt; create-react-app default file\n    ├── setupTests.js -------------&gt; for jest config \n    ├── static --------------------&gt; for static files\n    ├── store ---------------------&gt; redux store config\n    │   └── index.js\n    └── styles --------------------&gt; custom styles in sass, compiled into css\n        ├── output\n        │   └── master.css\n        └── source\n            ├── ContentPage.sass\n            ├── Drawer.sass\n            ├── Normalize.sass\n            ├── SearchResult.sass\n            ├── TopNav.sass\n            ├── VideoPlayer.sass\n            └── master.sass</code></pre></div>\n<p>Now I need to go onto component testing with jest &#x26; enzyme, but I know nothing, so now I need to find things out.</p>\n<h2>Seeing Jest output in detail</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">react-scripts-rewired test --env=jsdom --coverage --verbose</code></pre></div>\n<p>will output</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> PASS  src/__test__/components/Drawer/Drawer.test.js\n  Drawer component\n    ✓ renders Drawer with id (10ms)\n\n  console.error node_modules/fbjs/lib/warning.js:33\n    Warning: React depends on requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\n\n  console.error node_modules/fbjs/lib/warning.js:33\n    Warning: React depends on requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills\n\n PASS  src/__test__/reducers/reducers.test.js\n  Store\n    ✓ should handle toggleDrawer action (4ms)\n    ✓ should handle requestSearch action (1ms)\n    ✓ should handle receiveSearch action (1ms)\n\nTest Suites: 2 passed, 2 total\nTests:       4 passed, 4 total\nSnapshots:   0 total\nTime:        2.555s\nRan all test suites.\n-----------------------------|----------|----------|----------|----------|-------------------|\nFile                         |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |\n-----------------------------|----------|----------|----------|----------|-------------------|\nAll files                    |     6.73 |     7.07 |     9.23 |       10 |                   |\n src                         |     1.28 |        0 |        0 |      2.7 |                   |\n  App.js                     |        0 |        0 |        0 |        0 |  1,15,16,18,19,23 |\n  index.js                   |        0 |        0 |        0 |        0 |... 24,25,28,29,30 |\n  registerServiceWorker.js   |        0 |        0 |        0 |        0 |... 40,141,142,143 |\n  setupTests.js              |      100 |      100 |      100 |      100 |                   |\n src/actions                 |      100 |      100 |      100 |      100 |                   |\n  constants.js               |      100 |      100 |      100 |      100 |                   |\n  index.js                   |      100 |      100 |      100 |      100 |                   |\n src/components/Containers   |        0 |        0 |        0 |        0 |                   |\n  index.js                   |        0 |        0 |        0 |        0 |... 11,13,16,19,24 |\n src/components/Drawer       |    66.67 |      100 |       25 |    66.67 |                   |\n  Drawer.js                  |      100 |      100 |      100 |      100 |                   |\n  DrawerItems.js             |       50 |      100 |        0 |       50 |          14,21,30 |\n src/components/SearchResult |        0 |        0 |        0 |        0 |                   |\n  SearchResultCard.js        |        0 |        0 |        0 |        0 |... 12,20,24,49,55 |\n  SearchResultPanel.js       |        0 |        0 |        0 |        0 |... ,6,10,11,20,34 |\n src/components/TopNav       |        0 |        0 |        0 |        0 |                   |\n  TopNav.js                  |        0 |        0 |        0 |        0 |... 51,53,54,62,68 |\n src/components/VideoPlayer  |        0 |        0 |        0 |        0 |                   |\n  VideoPlayer.js             |        0 |        0 |        0 |        0 |... 12,20,22,26,27 |\n  VideoPlayerPanel.js        |        0 |        0 |        0 |        0 |... ,5,6,8,9,24,25 |\n src/layout                  |        0 |        0 |        0 |        0 |                   |\n  contentPage.js             |        0 |        0 |        0 |        0 |... 13,17,19,28,32 |\n  default.js                 |        0 |        0 |        0 |        0 |   1,2,3,5,6,11,15 |\n src/modules                 |        0 |        0 |        0 |        0 |                   |\n  resize.js                  |        0 |        0 |        0 |        0 |... ,9,10,11,12,14 |\n src/pages                   |        0 |        0 |        0 |        0 |                   |\n  About.js                   |        0 |        0 |        0 |        0 |                   |\n  Home.js                    |        0 |        0 |        0 |        0 |... ,9,10,11,14,15 |\n  SearchResultView.js        |        0 |        0 |        0 |        0 |       1,2,3,5,6,7 |\n  Settings.js                |        0 |        0 |        0 |        0 |                   |\n  VideoPlayerView.js         |        0 |        0 |        0 |        0 |... ,4,5,7,8,13,14 |\n src/reducers                |      100 |      100 |      100 |      100 |                   |\n  reducers.js                |      100 |      100 |      100 |      100 |                   |\n src/store                   |        0 |        0 |        0 |        0 |                   |\n  index.js                   |        0 |        0 |        0 |        0 |           1,2,4,6 |\n-----------------------------|----------|----------|----------|----------|-------------------|</code></pre></div>\n<h2>” Warning: React depends on requestAnimationFrame. Make sure that you load a polyfill in older browsers. <a href=\"http://fb.me/react-polyfills\">http://fb.me/react-polyfills</a>”</h2>\n<p>How do I solve this? I suddenly faced this error while I have done nothing wrong. So I looked for <a href=\"https://github.com/facebook/create-react-app/issues/3199\">answers on github</a>.</p>\n<p>It seems that the issue is NOT an error, but just a warning, so it’s just a matter of being bothered by it. But if we are being too bothered, here’s the solution from the github issues (actually this problem was resolved as of <code class=\"language-text\">react-scripts@1.0.15</code>, but since I am using <code class=\"language-text\">react-app-rewired</code> which is not really maintained, I had to fix this):</p>\n<p>So first, make <code class=\"language-text\">tempPolyfills.js</code> as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> raf <span class=\"token operator\">=</span> global<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">requestAnimationFrame</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>cb<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>cb<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> raf</code></pre></div>\n<p>and <code class=\"language-text\">setupTests.js</code> (at the top level inside <code class=\"language-text\">src</code>):</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> raf <span class=\"token keyword\">from</span> <span class=\"token string\">'./tempPolyfills'</span>\n<span class=\"token keyword\">import</span> Enzyme<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> shallow<span class=\"token punctuation\">,</span> render<span class=\"token punctuation\">,</span> mount <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'enzyme'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Adapter <span class=\"token keyword\">from</span> <span class=\"token string\">'enzyme-adapter-react-16'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> toJson <span class=\"token keyword\">from</span> <span class=\"token string\">'enzyme-to-json'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// React 16 Enzyme adapter</span>\nEnzyme<span class=\"token punctuation\">.</span><span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> adapter<span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Adapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Make Enzyme functions available in all test files without importing</span>\nglobal<span class=\"token punctuation\">.</span>shallow <span class=\"token operator\">=</span> shallow<span class=\"token punctuation\">;</span>\nglobal<span class=\"token punctuation\">.</span>render <span class=\"token operator\">=</span> render<span class=\"token punctuation\">;</span>\nglobal<span class=\"token punctuation\">.</span>mount <span class=\"token operator\">=</span> mount<span class=\"token punctuation\">;</span>\nglobal<span class=\"token punctuation\">.</span>toJson <span class=\"token operator\">=</span> toJson<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Fail tests on any warning</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">error</span> <span class=\"token operator\">=</span> message <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>and of course, install <code class=\"language-text\">enzyme-to-json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save-dev enzyme-to-json</code></pre></div>\n<p>And now, if you try on jest, it is not going to complain, free from warnigs!</p>\n<h2>Excluding from tests</h2>\n<p><code class=\"language-text\">setupTests.js</code> and <code class=\"language-text\">tempPolyfills.js</code> are still in the coverage reported by <code class=\"language-text\">istanbul</code>. Excluding them is an easy peasy job. Just add to <code class=\"language-text\">package.json</code> this snippet:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;jest&quot;: {\n    &quot;setupFiles&quot;: [\n      &quot;&lt;rootDir&gt;/src/setupTests.js&quot;\n    ],\n    &quot;coveragePathIgnorePatterns&quot;: [\n      &quot;/node_modules/&quot;,\n      &quot;setupTests.js&quot;,\n      &quot;tempPolyfills.js&quot;,\n      &quot;src/index.js&quot;,\n      &quot;registerServiceWorker.js&quot;\n    ]\n  }</code></pre></div>\n<p>You can put regex pattern strings in <code class=\"language-text\">coveragePathIgnorePatterns</code> to ignore files and folders. See more at the <a href=\"https://jestjs.io/docs/en/configuration.html#coveragepathignorepatterns-array-string\">Jest docs</a>. </p>\n<h2>Testing a component</h2>\n<ul>\n<li>\n<p>Sources: </p>\n<ul>\n<li><a href=\"https://medium.freecodecamp.org/the-right-way-to-test-react-components-548a4736ab22\">freecodecamp</a></li>\n</ul>\n</li>\n</ul>\n<h3>Important points to inspect when testing a component</h3>\n<ul>\n<li>\n<p>What it renders</p>\n</li>\n<li>\n<p>The props the component receives</p>\n</li>\n<li>\n<p>The state the component holds (if any)</p>\n</li>\n<li>\n<p>What the component does when the user interacts with it (via clicking, dragging, keyboard input, etc)</p>\n</li>\n<li>\n<p>The context the component is rendered in</p>\n</li>\n<li>\n<p>What the component does when you call methods on its instance (public ref interface)</p>\n</li>\n<li>\n<p>Side effects that occur as part of the component lifecycle (componentDidMount, componentWillUnmount, etc)</p>\n</li>\n<li>\n<p>Don’t test the things already covered by the library. </p>\n</li>\n</ul>\n<h3>Hands on</h3>\n<p>And the component I’m testing is this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> PropTypes <span class=\"token keyword\">from</span> <span class=\"token string\">\"prop-types\"</span>\n<span class=\"token keyword\">import</span> Drawer <span class=\"token keyword\">from</span> <span class=\"token string\">\"@material-ui/core/Drawer\"</span>\n<span class=\"token keyword\">import</span> DrawerItems <span class=\"token keyword\">from</span> <span class=\"token string\">\"./DrawerItems\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Drawer2</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> isDrawerOpen<span class=\"token punctuation\">,</span> onToggle <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> \n  <span class=\"token operator\">&lt;</span>Drawer open<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>isDrawerOpen<span class=\"token punctuation\">}</span> anchor<span class=\"token operator\">=</span><span class=\"token string\">\"left\"</span> onClose<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onToggle<span class=\"token punctuation\">}</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"drawer\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>div tabIndex<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span> role<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onToggle<span class=\"token punctuation\">}</span> onKeyDown<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onToggle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>DrawerItems <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Drawer<span class=\"token operator\">></span>\n\nDrawer2<span class=\"token punctuation\">.</span>propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  isDrawerOpen<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span>bool<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n  onToggle<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Drawer2</code></pre></div>\n<p>And here are the contracts I found on this component (though simple):</p>\n<ul>\n<li><code class=\"language-text\">Drawer</code> always gets rendered.</li>\n<li><code class=\"language-text\">div</code> inside <code class=\"language-text\">Drawer</code> always gets rendered.</li>\n<li><code class=\"language-text\">div</code> receives <code class=\"language-text\">tabIndex</code> and <code class=\"language-text\">role</code> as props (but isn’t this too trivial to test? So did not test this). </li>\n<li><code class=\"language-text\">DrawerItems</code> inside <code class=\"language-text\">div</code> always gets rendered. </li>\n<li><code class=\"language-text\">Drawer2</code> receives two props which are directly applied to <code class=\"language-text\">open</code>, <code class=\"language-text\">onClose</code> in <code class=\"language-text\">Drawer</code>, and <code class=\"language-text\">onClick</code>, <code class=\"language-text\">onKeyDown</code> in <code class=\"language-text\">div</code> as props. </li>\n</ul>\n<p>There are no conditional renderings going on here, so there are not so many contracts I can identify, but these are just about them, I think. And so, these are the tests:</p>\n<p>…</p>\n<p>woops.. a big problem appeared. When I tried to <code class=\"language-text\">mount</code> the component under test, it gave me an error, while <code class=\"language-text\">shallow</code> did not. After </p>\n<p>After a length of hours of fighting against the errrors, I found that there is some kind of a consistent error happening on the <code class=\"language-text\">DrawerItems</code> component. And it turns out to be a composite problem between <code class=\"language-text\">react-app-rewired</code> and <code class=\"language-text\">react</code> and … <code class=\"language-text\">material-ui</code>. </p>\n<p>So I got this lesson:</p>\n<ol>\n<li>Use the framework that is maintained (not <code class=\"language-text\">react-app-rewired</code>, but the official <code class=\"language-text\">react-scripts</code>)</li>\n<li>If you are to add tests, add the tests from the beginning of the project.\nAnd after all, I found that the component of the matter was <code class=\"language-text\">DrawerItem</code>. When I tried to <code class=\"language-text\">mount</code> it, it gave me the same error. But React rendered it perfectly, so only <code class=\"language-text\">enzyme</code> had a problem dealing with this component. </li>\n</ol>\n<p>So I had no choice, but to render it shallowly or entirely with <code class=\"language-text\">ReactDOM</code> on each component.</p>\n<p>So these are my testing scripts and corresponding components:\n<code class=\"language-text\">Drawer.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> PropTypes <span class=\"token keyword\">from</span> <span class=\"token string\">\"prop-types\"</span>\n<span class=\"token keyword\">import</span> Drawer <span class=\"token keyword\">from</span> <span class=\"token string\">\"@material-ui/core/Drawer\"</span>\n<span class=\"token keyword\">import</span> DrawerItems <span class=\"token keyword\">from</span> <span class=\"token string\">\"./DrawerItems\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Drawer2</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> isDrawerOpen<span class=\"token punctuation\">,</span> onToggle <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Drawer open<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>isDrawerOpen<span class=\"token punctuation\">}</span> anchor<span class=\"token operator\">=</span><span class=\"token string\">\"left\"</span> onClose<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onToggle<span class=\"token punctuation\">}</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"drawer\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>div tabIndex<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span> role<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onToggle<span class=\"token punctuation\">}</span> onKeyDown<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onToggle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>DrawerItems <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Drawer<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span>\n\nDrawer2<span class=\"token punctuation\">.</span>propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  isDrawerOpen<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span>bool<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n  onToggle<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Drawer2</code></pre></div>\n<p><code class=\"language-text\">Drawer.test.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> shallow <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"enzyme\"</span>\n<span class=\"token keyword\">import</span> Drawer <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../../components/Drawer/Drawer\"</span>\n<span class=\"token keyword\">import</span> DrawerItems <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../../components/Drawer/DrawerItems\"</span>\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Drawer\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    isDrawerOpen<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    onToggle<span class=\"token punctuation\">:</span> f <span class=\"token operator\">=></span> f<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> shallowDrawer <span class=\"token operator\">=</span> <span class=\"token function\">shallow</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Drawer <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"renders Drawer with id\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>shallowDrawer<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#drawer\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"renders div\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>shallowDrawer<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"renders DrawerItems\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>shallowDrawer<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>DrawerItems<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">DrawerItems.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"></code></pre></div>\n<p><code class=\"language-text\">DrawerItems.test.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> shallow <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"enzyme\"</span>\n<span class=\"token keyword\">import</span> renderer <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-test-renderer\"</span>\n<span class=\"token keyword\">import</span> Drawer <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../../components/Drawer/Drawer\"</span>\n<span class=\"token keyword\">import</span> DrawerItems <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../../components/Drawer/DrawerItems\"</span>\n<span class=\"token keyword\">import</span> DrawerItem <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../../components/Drawer/DrawerItem\"</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DrawerItems\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> shallowDrawerItems <span class=\"token operator\">=</span> <span class=\"token function\">shallow</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>DrawerItems <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"renders multiple items\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>shallowDrawerItems<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>DrawerItem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeGreaterThan</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">DrawerItem.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> PropTypes <span class=\"token keyword\">from</span> <span class=\"token string\">\"prop-types\"</span>\n<span class=\"token keyword\">import</span> ListItem <span class=\"token keyword\">from</span> <span class=\"token string\">\"@material-ui/core/ListItem\"</span>\n<span class=\"token keyword\">import</span> ListItemIcon <span class=\"token keyword\">from</span> <span class=\"token string\">\"@material-ui/core/ListItemIcon\"</span>\n<span class=\"token keyword\">import</span> ListItemText <span class=\"token keyword\">from</span> <span class=\"token string\">\"@material-ui/core/ListItemText\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-router-dom\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">DrawerItem</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> link<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>ListItem button<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>link<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>ListItemIcon<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ListItemIcon<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>ListItemText primary<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ListItem<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span>\n\nDrawerItem<span class=\"token punctuation\">.</span>propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  link<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n  name<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n  children<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span><span class=\"token function\">oneOfType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    PropTypes<span class=\"token punctuation\">.</span><span class=\"token function\">arrayOf</span><span class=\"token punctuation\">(</span>PropTypes<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    PropTypes<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> DrawerItem</code></pre></div>\n<p><code class=\"language-text\">DrawerItem.test.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> ReactDOM <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-dom\"</span>\n<span class=\"token keyword\">import</span> MemoryRouter <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-router/MemoryRouter\"</span>\n<span class=\"token keyword\">import</span> DrawerItem <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../../components/Drawer/DrawerItem\"</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DrawerItem\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    link<span class=\"token punctuation\">:</span> <span class=\"token string\">\"/settings\"</span><span class=\"token punctuation\">,</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Settings\"</span><span class=\"token punctuation\">,</span>\n    children<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>div <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"accepts link prop\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> node <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span>\n\n    ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>MemoryRouter<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>DrawerItem <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MemoryRouter<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n      node\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> href <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/settings\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>More talking</h2>\n<p>But still, I felt like I had to test props like <code class=\"language-text\">onClick</code> that receives <code class=\"language-text\">onToggle</code> prop, which is a functionality assumed to work well. But <code class=\"language-text\">mount</code> never worked, so it was not really possible to test this..</p>","frontmatter":{"title":"Controlled youtube (2): adding tests","date":"September 18, 2018","description":null}}},"pageContext":{"slug":"/2018-09-18--Controlled-youtube-(2):-adding-tests/","previous":{"fields":{"slug":"/2018-09-05--Async-and-await/"},"frontmatter":{"title":"Async and await"}},"next":{"fields":{"slug":"/2018-10-07--Using-React-and-Express-Together/"},"frontmatter":{"title":"Using React and Express together"}}}}