{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-03-17--deploying-a-serverless-crawler-with-python-+-lambda+dynamoDB/","result":{"data":{"site":{"siteMetadata":{"title":"Joel's dev blog","author":"Joel Mun","siteUrl":"https://9oelm.github.io"}},"markdownRemark":{"id":"027c3471-c074-5b3c-987e-f1a2a3575f70","excerpt":"What I’m gonna build I’m gonna build a simple crawler that will send HTTP request to zigbang.com’s api server to receive data on estates, and then save it to…","html":"<h1 id=\"what-im-gonna-build\" style=\"position:relative;\">What I’m gonna build<a href=\"#what-im-gonna-build\" aria-label=\"what im gonna build permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>I’m gonna build a simple crawler that will send HTTP request to zigbang.com’s api server to receive data on estates, and then save it to dynamoDB. </p>\n<h1 id=\"prerequisites\" style=\"position:relative;\">Prerequisites<a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<ul>\n<li>\n<p>Have a recent version of node installed</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">nvm <span class=\"token function\">install</span> stable</code></pre></div>\n</li>\n<li>\n<p>Install <code class=\"language-text\">serverless</code> globally</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g serverless</code></pre></div>\n</li>\n</ul>\n<h1 id=\"initialize-serverless-project\" style=\"position:relative;\">Initialize serverless project<a href=\"#initialize-serverless-project\" aria-label=\"initialize serverless project permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>To initialize it with a python <a href=\"https://serverless.com/framework/docs/providers/aws/cli-reference/create/\">template</a>,</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">serverless create --template aws-python3</code></pre></div>\n<p>see more templates <a href=\"https://serverless.com/framework/docs/providers/aws/cli-reference/create#available-templates\">from the documentation.</a></p>\n<p>Then you are gonna see something like</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Serverless: Generating boilerplate...\n _______                             __\n|   _   .-----.----.--.--.-----.----|  .-----.-----.-----.\n|   |___|  -__|   _|  |  |  -__|   _|  |  -__|__ --|__ --|\n|____   |_____|__|  \\___/|_____|__| |__|_____|_____|_____|\n|   |   |             The Serverless Application Framework\n|       |                           serverless.com, v1.39.0\n -------&#39;\n\nServerless: Successfully generated boilerplate for template: &quot;aws-python3&quot;\nServerless: NOTE: Please update the &quot;service&quot; property in serverless.yml with your service name</code></pre></div>\n<p>Successful!</p>\n<h1 id=\"give-permission-to-serverless-cli-on-aws\" style=\"position:relative;\">Give permission to <code class=\"language-text\">serverless</code> cli on aws<a href=\"#give-permission-to-serverless-cli-on-aws\" aria-label=\"give permission to serverless cli on aws permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<h2 id=\"aws-access-keys\" style=\"position:relative;\">AWS Access keys<a href=\"#aws-access-keys\" aria-label=\"aws access keys permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>You need to create something called <em>AWS Access Keys</em>.</p>\n<ol>\n<li>Head over to <a href=\"https://console.aws.amazon.com/iam/home\">Identity and Access Management home</a></li>\n<li>Browse to <a href=\"https://console.aws.amazon.com/iam/home#/users\">Users tab</a> and click <em>add user</em>.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABsklEQVQ4y61U227iQAyd79rX/Yd+0D70C/aj2n2s+tJSRWWhpRBEbjOZa3JqG4ZShCqEsHJkZzI+sY8nUbiC3b06TMoosUopwVqLqqrQNA3W6zW89xiGASkx0glExBgRIvsE4wKsD7KmmJUJmKgsSyyXS3Rdh77vobWG6Q2M0RR30F1LsUFrI1xIlDnSNYofyXMRapQFyEIGJ2lt0BmHutFotIV2EZ3dwSW6H9D7AYbg47hvf094aI4kML3F/48GT8UHXt5rIeFEGwa4SCBvdwjpq0qVq8v6cNn7qg9wrgmhc060Yw0Zq9VKNIwhCAKBdba0z1on+zl2GZ6HkhBpiEKYJ81gos1mI1PvSMeqqiVm8JD4ed63jck7T5pSh8N4WsOc6EPEfD7HbDbDdDpFXdfyjI9X27Z74hC8EAfqQh1P+PAF3CoTTSYTFEUh5IvFQkil7V1XW7ivc5hJj8l5QLyZCXLVueWs3+HaN8JjOyXF2VM+JjpV7blQuLKpS6r4scJrkAwywC2u33L+fi8B/y8j5T8vHR7frEDxd3tJm/zL2GiPadnj5u8Dfv25x+/bf/gEkpXSGXsIP1MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Add user\"\n        title=\"Add user\"\n        src=\"/static/83a303283d988a2c050cd02c9223e8fc/fcda8/1.png\"\n        srcset=\"/static/83a303283d988a2c050cd02c9223e8fc/12f09/1.png 148w,\n/static/83a303283d988a2c050cd02c9223e8fc/e4a3f/1.png 295w,\n/static/83a303283d988a2c050cd02c9223e8fc/fcda8/1.png 590w,\n/static/83a303283d988a2c050cd02c9223e8fc/efc66/1.png 885w,\n/static/83a303283d988a2c050cd02c9223e8fc/3a737/1.png 897w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></li>\n<li>\n<p>Click on <em>Attach existing policies directly</em> and <em>Create policy</em>.\nAdd the following <a href=\"https://gist.github.com/ServerlessBot/7618156b8671840a539f405dea2704c8\">json provided by <code class=\"language-text\">serverless</code> team</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n<span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">\"apigateway:*\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:CancelUpdateStack\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:ContinueUpdateRollback\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:CreateChangeSet\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:CreateStack\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:CreateUploadBucket\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:DeleteStack\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:Describe*\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:EstimateTemplateCost\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:ExecuteChangeSet\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:Get*\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:List*\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:PreviewStackUpdate\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:UpdateStack\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:UpdateTerminationProtection\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudformation:ValidateTemplate\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"dynamodb:CreateTable\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"dynamodb:DeleteTable\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"dynamodb:DescribeTable\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:AttachInternetGateway\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:AuthorizeSecurityGroupIngress\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:CreateInternetGateway\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:CreateNetworkAcl\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:CreateNetworkAclEntry\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:CreateRouteTable\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:CreateSecurityGroup\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:CreateSubnet\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:CreateTags\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:CreateVpc\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:DeleteInternetGateway\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:DeleteNetworkAcl\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:DeleteNetworkAclEntry\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:DeleteRouteTable\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:DeleteSecurityGroup\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:DeleteSubnet\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:DeleteVpc\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:Describe*\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:DetachInternetGateway\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ec2:ModifyVpcAttribute\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"events:DeleteRule\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"events:DescribeRule\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"events:ListRuleNamesByTarget\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"events:ListRules\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"events:ListTargetsByRule\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"events:PutRule\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"events:PutTargets\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"events:RemoveTargets\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iam:CreateRole\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iam:DeleteRole\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iam:DeleteRolePolicy\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iam:GetRole\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iam:PassRole\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iam:PutRolePolicy\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iot:CreateTopicRule\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iot:DeleteTopicRule\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iot:DisableTopicRule\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iot:EnableTopicRule\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"iot:ReplaceTopicRule\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"kinesis:CreateStream\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"kinesis:DeleteStream\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"kinesis:DescribeStream\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"lambda:*\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:CreateLogGroup\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:DeleteLogGroup\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:DescribeLogGroups\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:DescribeLogStreams\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:FilterLogEvents\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:GetLogEvents\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:CreateBucket\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:DeleteBucket\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:DeleteBucketPolicy\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:DeleteObject\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:DeleteObjectVersion\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:GetObject\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:GetObjectVersion\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:ListAllMyBuckets\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:ListBucket\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:PutBucketNotification\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:PutBucketPolicy\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:PutBucketTagging\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:PutBucketWebsite\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:PutEncryptionConfiguration\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:PutObject\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:CreateTopic\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:DeleteTopic\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:GetSubscriptionAttributes\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:GetTopicAttributes\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:ListSubscriptions\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:ListSubscriptionsByTopic\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:ListTopics\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:SetSubscriptionAttributes\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:SetTopicAttributes\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:Subscribe\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"sns:Unsubscribe\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"states:CreateStateMachine\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"states:DeleteStateMachine\"</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>Click <em>Next</em> until you see <em>Create user</em>. Then, copy the <em>Access Key ID</em> and <em>Secret access key</em> to somewhere like notepad.</li>\n<li>\n<p>Enter in the API keys</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">AWS_ACCESS_KEY_ID</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-key-here<span class=\"token operator\">></span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">AWS_SECRET_ACCESS_KEY</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-secret-key-here<span class=\"token operator\">></span>\n<span class=\"token comment\"># AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY are now available for serverless to use</span></code></pre></div>\n</li>\n<li>\n<p>Deploy</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">serverless deploy</code></pre></div>\n<p>Then you are gonna see </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Serverless: Packaging service<span class=\"token punctuation\">..</span>.\nServerless: Excluding development dependencies<span class=\"token punctuation\">..</span>.\nServerless: Creating Stack<span class=\"token punctuation\">..</span>.\nServerless: Checking Stack create progress<span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.\nServerless: Stack create finished<span class=\"token punctuation\">..</span>.\nServerless: Uploading CloudFormation <span class=\"token function\">file</span> to S3<span class=\"token punctuation\">..</span>.\nServerless: Uploading artifacts<span class=\"token punctuation\">..</span>.\nServerless: Uploading <span class=\"token function\">service</span> aws-python3.zip <span class=\"token function\">file</span> to S3 <span class=\"token punctuation\">(</span><span class=\"token number\">1.97</span> KB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">..</span>.\nServerless: Validating template<span class=\"token punctuation\">..</span>.\nServerless: Updating Stack<span class=\"token punctuation\">..</span>.\nServerless: Checking Stack update progress<span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.\nServerless: Stack update finished<span class=\"token punctuation\">..</span>.\nService Information\nservice: aws-python3\nstage: dev\nregion: us-east-1\nstack: aws-python3-dev\nresources: <span class=\"token number\">5</span>\napi keys:\nNone\nendpoints:\nNone\nfunctions:\nhello: aws-python3-dev-hello\nlayers:\nNone</code></pre></div>\n</li>\n<li>Add a profile\nYes. Do add a profile so that next time you create a similar kind of project, you will not have to enter in your api keys again.</li>\n<li>\n<p><a href=\"https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/cli-chap-install.html\">install <code class=\"language-text\">awscli</code></a> (if this does not work, use <a href=\"https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/install-bundle.html\">bundle installer.</a> If the install command <a href=\"https://github.com/MeetMe/newrelic-plugin-agent/issues/151\">breaks with an error, perhaps run <code class=\"language-text\">apt-get install</code>apt-get install python-dev`</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> awscli --upgrade --user</code></pre></div>\n</li>\n<li>\n<p><a href=\"https://serverless.com/framework/docs/providers/aws/cli-reference/config-credentials/\">initialize a profile</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">serverless config credentials --provider aws --key <span class=\"token number\">1234</span> --secret <span class=\"token number\">5678</span> --profile custom-profile</code></pre></div>\n</li>\n<li>\n<p>Later on, you can use this profile in this way:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">serverless deploy --aws-profile profileIjustMade</code></pre></div>\n<p>of course you can modify your profile info and api keys in <code class=\"language-text\">~/.aws/credentials</code>.</p>\n</li>\n</ol>\n<h1 id=\"check-your-function-is-working\" style=\"position:relative;\">Check your function is working<a href=\"#check-your-function-is-working\" aria-label=\"check your function is working permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>First, set a function name in <code class=\"language-text\">serverless.yml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">functions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">hello</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> handler.hello\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hello</code></pre></div>\n<p>Then <code class=\"language-text\">sls deploy</code> again to make changes.\nNow, </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ serverless invoke -f hello\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"statusCode\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token number\">200</span>,\n    <span class=\"token string\">\"body\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"{<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>message<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>Go Serverless v1.0! Your function executed successfully!<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>, <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>input<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: {}}\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>yes, it works!!</p>\n<h1 id=\"want-to-include-python-modules-make-a-deployment-package\" style=\"position:relative;\">Want to include python modules? Make a <a href=\"https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/lambda-python-how-to-create-deployment-package.html\">deployment package.</a><a href=\"#want-to-include-python-modules-make-a-deployment-package\" aria-label=\"want to include python modules make a deployment package permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<blockquote>\n<p><strong>A deployment package is a ZIP archive that contains your function code and dependencies.</strong> </p>\n</blockquote>\n<blockquote>\n<p>You need to create a deployment package if you use the Lambda API to manage functions, or <strong>if your code uses libraries other than the AWS SDK.</strong> Other libraries and dependencies need to be included in the deployment package. You can upload the package directly to Lambda, or you can use an Amazon S3 bucket, and then upload it to Lambda.</p>\n</blockquote>\n<ol>\n<li>First, you would need to have aws cli installed. If you have not, check above for steps. </li>\n<li>\n<p>Then install dependencies to a local directory with pip, and include them in your deployment package.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">j031:~/workspace <span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">)</span> $ <span class=\"token function\">mkdir</span> packages\nj031:~/workspace <span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">)</span> $ <span class=\"token builtin class-name\">cd</span> packages/\nj031:~/workspace/packages <span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">)</span> $ <span class=\"token function\">ls</span>\nj031:~/workspace/packages <span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">)</span> $ pip <span class=\"token function\">install</span> requests --target <span class=\"token builtin class-name\">.</span></code></pre></div>\n</li>\n<li>\n<p>Create zip of packages </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ zip -r9 ../function.zip .</code></pre></div>\n</li>\n<li>\n<p>Add function code to the zip</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">j031:~/workspace/es (master) $ zip -g function.zip handler.py\nadding: handler.py (deflated 50%)</code></pre></div>\n</li>\n<li>\n<p>Upload!</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">j031:~/workspace/es (master) $ aws lambda update-function-code --function-name crawler --zip-file fileb://function.zip</code></pre></div>\n</li>\n<li>\n<p>If you feel tiredsome, just create <code class=\"language-text\">update.sh</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">mkdir .tmp\nzip -r9 ./.tmp/function.zip ./packages\nzip -g ./.tmp/function.zip handler.py\naws lambda update-function-code --function-name crawler --zip-file fileb://./.tmp/function.zip\nrm -rf ./.tmp</code></pre></div>\n</li>\n</ol>\n<h1 id=\"or-use-serverless-python-requirements\" style=\"position:relative;\">OR use serverless-python-requirements<a href=\"#or-use-serverless-python-requirements\" aria-label=\"or use serverless python requirements permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><a href=\"https://github.com/UnitedIncome/serverless-python-requirements\">Just install it</a>, and produce <code class=\"language-text\">requirements.txt</code> by running <code class=\"language-text\">pip freeze &gt; requirements.txt</code> and run <code class=\"language-text\">sls deploy</code>.\n<em>I find this way very much simpler and easier!</em></p>\n<h1 id=\"source-code\" style=\"position:relative;\">Source code<a href=\"#source-code\" aria-label=\"source code permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><a href=\"https://github.com/9oelM/es\">The source code can be found from this repo!</a></p>\n<h1 id=\"serverlessyml\" style=\"position:relative;\">serverless.yml<a href=\"#serverlessyml\" aria-label=\"serverlessyml permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>In the <code class=\"language-text\">name</code> and other relevant fields, fill out suitable values.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> crawl<span class=\"token punctuation\">-</span>service <span class=\"token comment\"># NOTE: update this with your service name</span>\n\n<span class=\"token punctuation\">...</span>\n\n<span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> aws\n  <span class=\"token key atrule\">runtime</span><span class=\"token punctuation\">:</span> python3.6\n  <span class=\"token key atrule\">region</span><span class=\"token punctuation\">:</span> us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n\n<span class=\"token punctuation\">...</span>\n\n<span class=\"token key atrule\">functions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">crawler</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> handler.crawler <span class=\"token comment\"># # The file and module for this specific function.</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> crawler\n    \n    <span class=\"token punctuation\">...</span></code></pre></div>","frontmatter":{"title":"Deploying a serverless crawler with python + lambda","date":"March 18, 2019"}}},"pageContext":{"slug":"/2019-03-17--deploying-a-serverless-crawler-with-python-+-lambda+dynamoDB/","previous":{"fields":{"slug":"/2019-03-13--100BooksProject-(2):Crossroads-(갈림길)/"},"frontmatter":{"title":"100 Books Project (2): Crossroads (갈림길)","tab":"post"}},"next":{"fields":{"slug":"/2019-05-05--Memoization-in-python-using-a-decorator:-getting-a-prime-number/"},"frontmatter":{"title":"Memoization in python using a decorator: getting a prime number","tab":"post"}}}},"staticQueryHashes":["3128451518","426816048"]}