{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018-05-19--Using-foresic-tools-(1):-process-explorer,-process-monitor,-and-autoruns/","result":{"data":{"site":{"siteMetadata":{"title":"Joel's dev blog","author":"Joel Mun","siteUrl":"https://9oelm.github.io"}},"markdownRemark":{"id":"5f7315e3-0bdd-57fa-bb4f-dd7a69465a62","excerpt":"Sources CSO microsoft gist Corrie Erk Process explorer Submit to VirusTotal to check hash Process Explorer -> Options -> VirusTotal.com -> Check VirusTotal.com…","html":"<h2>Sources</h2>\n<ul>\n<li><a href=\"https://www.csoonline.com/article/2883958/malware/malware-detection-in-9-easy-steps.html\">CSO</a></li>\n<li><a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms724875(v=vs.85).aspx\">microsoft</a></li>\n<li><a href=\"https://gist.github.com/mgeeky/f0d13172d557e5860c0301dbf847de60\">gist</a></li>\n<li><a href=\"https://corrieerk.com/2017/01/filtering-with-process-monitor/\">Corrie Erk</a></li>\n</ul>\n<h2>Process explorer</h2>\n<h3>Submit to <a href=\"https://www.virustotal.com/en/\">VirusTotal</a> to check hash</h3>\n<p>Process Explorer -> Options -> VirusTotal.com -> Check VirusTotal.com</p>\n<p><img src=\"https://postfiles.pstatic.net/MjAxODA1MTlfMTc3/MDAxNTI2NjkzMTE0NDg1.c873q9HfZCtwfbPdxZtrR8aQY6E1VIrRt2CY0idq1Agg.M7dqQU-__syralfnwddSJINM1VzJsGopcYMHd8Xm9ccg.PNG.joelmun/%EC%BA%A1%EC%B2%982.PNG?type=w773\" alt=\"1\"></p>\n<p>Executables with high ratio mean higher chance of malicious behaviour.\nThe ratio is the number of virus engines that recognized the executable as a malicious software divided by total number of virus engines.\nIf the ratio is <code class=\"language-text\">1/67</code>, it is probably a false positive, but if it’s more than that, it’s worth doubting. </p>\n<p><img src=\"https://postfiles.pstatic.net/MjAxODA1MTlfMzYg/MDAxNTI2NjkyNjAzNTk2.nNB0G74x8fEXioLMxxTb4ACbPA1y-oAf5kEWX5kyomMg.tXYPoNYfBHnRIRU4XZlQMRk8V0h_HH7fSytnba0iv8gg.PNG.joelmun/%EC%BA%A1%EC%B2%98.PNG?type=w773\" alt=\"2\"></p>\n<p>If you want to delete the program, stop the program on boot using Autoruns and then delete it.</p>\n<h3>Verify image signatures</h3>\n<p>Process Explorer -> Options -> Verify image signatures</p>\n<h2>Process monitor</h2>\n<h3>Registry operations</h3>\n<p><code class=\"language-text\">RegQueryKey</code></p>\n<blockquote>\n<p>Retrieves information about the specified registry key.</p>\n</blockquote>\n<p><code class=\"language-text\">RegSetInfoKey</code></p>\n<blockquote>\n<p>Closes the specified registry key.</p>\n</blockquote>\n<p><code class=\"language-text\">RegCloseKey</code></p>\n<blockquote>\n<p>Closes the specified registry key.</p>\n</blockquote>\n<p><code class=\"language-text\">RegOpenKey</code></p>\n<blockquote>\n<p>Opens the specified registry key.</p>\n</blockquote>\n<p><code class=\"language-text\">RegCreateKey</code></p>\n<blockquote>\n<p><strong>Creates</strong> the specified registry key. If the key already exists in the registry, the function opens it.</p>\n</blockquote>\n<p><code class=\"language-text\">RegEnumKey</code></p>\n<blockquote>\n<p><strong>Enumerates the subkeys</strong> of the specified open registry key. The function retrieves the name of one subkey each time it is called.</p>\n</blockquote>\n<h3>Full list of proc mon operations</h3>\n<p>CloseFile\nCreateFile\nCreateFileMapping\nDeviceIoControl\nFileSystemControl\nFlushBuffersFile\nLoad Image\nLockFile\nNotifyChangeDirectory\nProcess Create\nProcess Exit\nProcess Profiling\nProcess Start\nQueryAllInformationFile\nQueryAttributeInformationVolume\nQueryAttributeTagFile\nQueryBasicInformationFile\nQueryDeviceRelations\nQueryDirectory\nQueryEAFile\nQueryFileInternalInformationFile\nQueryFullSizeInformationVolume\nQueryInformationVolume\nQueryNameInformationFile\nQueryNetworkOpenInformationFile\nQueryNormalizedNameInformationFile\nQueryObjectIdInformationVolume\nQueryOpen\nQueryPositionInformationFile\nQueryRemoteProtocolInformation\nQuerySecurityFile\nQuerySizeInformationVolume\nQueryStandardInformationFile\nQueryStreamInformationFile\nReadFile</p>\n<p>@@@@@@@@@@@@\nRegCloseKey\nRegCreateKey\nRegDeleteKey\nRegDeleteValue\nRegEnumKey\nRegEnumValue\nRegLoadKey\nRegOpenKey\nRegQueryKey\nRegQueryKeySecurity\nRegQueryMultipleValueKey\nRegQueryValue\nRegSetInfoKey\nRegSetKeySecurity\nRegSetValue\n@@@@@@@@@@@</p>\n<p>SetAllocationInformationFile\nSetBasicInformationFile\nSetDispositionInformationFile\nSetEndOfFileInformationFile\nSetPositionInformationFile\nSetRenameInformationFile\nSetSecurityFile\nTCP Accept\nTCP Connect\nTCP Disconnect\nTCP Receive\nTCP Reconnect\nTCP Retransmit\nTCP Send\nTCP TCPCopy\nThread Create\nThread Exit\nUDP Receive\nUDP Send\nUnlockFileSingle\nWriteFile</p>\n<h3>Use filter to narrow down to the thing</h3>\n<p>Process monitor -> Filter -> Filter -> Include / Exclude </p>\n<p><img src=\"https://postfiles.pstatic.net/MjAxODA1MTlfMjg2/MDAxNTI2NzI4NzkzNTIx.Q2FHWZYCpjZPKzV7nHx_yF39TevJi4NnoXBiVju2l5Qg.ghJJnjehXfDuY2sRMv1CH9ghdUiOIBgLtomxvOCgeKYg.PNG.joelmun/%EC%BA%A1%EC%B2%98.PNG?type=w773\" alt=\"filter\"></p>\n<p>Operations to watch over</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">WriteFile\nCreateFile\nProcess Create\nProcess Start\nRegCreateKey\nRegDeleteKey\nRegSetInfoKey\nTCP Connect\nTCP Receive\nLoad Image\nAccess Denied</code></pre></div>\n<p>Filter by <code class=\"language-text\">Path contains suspiciousExecutable</code>.</p>\n<p>Filter by <code class=\"language-text\">Path contains &quot;\\Run&quot;</code></p>\n<h3>Use process tree to find out any children processes exist</h3>\n<p>Process monitor -> Tools -> Process tree</p>\n<h3>Use <code class=\"language-text\">Jump to</code> to see the registry change directly on regedit.</h3>\n<p><img src=\"https://postfiles.pstatic.net/MjAxODA1MTlfOTMg/MDAxNTI2NzI5NjY4MjAz.wmyLIK-WYkVUG334EArw8GAEIm2mPXOWJHIinsFCOvcg.siHAJitHWe0L2spS2x25qsss98ZFc6gD2m9LDJ7bTmQg.PNG.joelmun/2.PNG?type=w773\" alt=\"2\">\n<img src=\"https://postfiles.pstatic.net/MjAxODA1MTlfMjEg/MDAxNTI2NzI5NjcxMjMx.UbwOSXl1AZbF-Ff9ygfxksgu3-vT6-S1bcJU4rKa0AYg.0wTBKtNlgRZlsRrKRgTlo2wgSp7B_JGJImZAIb6pa-sg.PNG.joelmun/3.PNG?type=w773\" alt=\"3\"></p>\n<h3>Additional tips</h3>\n<ul>\n<li>Stop capturing at first and set the filter first</li>\n<li>See Tools -> ~ Summary (ex. Registry summary) to see which path has been made changes the most or do other useful operations.</li>\n<li>Use the “target button” to directly select on the screen which process to monitor.</li>\n</ul>\n<h2>Autoruns</h2>\n<h3>Scanning on VirusTotal and Verifying image signatures</h3>\n<p>Autoruns share the same function with process explorer. It can submit the hash to virusTotal and verify signatures as well:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Options -&gt; Scan options -&gt; Verify image signatures\nOptions -&gt; Scan options -&gt; Check VirusTotal.com</code></pre></div>\n<h3>Jump to Image</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Select application\nEntry -&gt; Jump to Image</code></pre></div>\n<p>Opens the directory where the selected application is at.</p>\n<h3>Jump to registry</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Select application\nEntry -&gt; Jump to Entry</code></pre></div>\n<h3>The suspicious look suspicious.</h3>\n<p>Suspicious files often do not have or have weird descriptions, and do strange registry operations. </p>","frontmatter":{"title":"Using foresic tools (1): process explorer, process monitor, and autoruns","date":"May 19, 2018"}}},"pageContext":{"slug":"/2018-05-19--Using-foresic-tools-(1):-process-explorer,-process-monitor,-and-autoruns/","previous":{"fields":{"slug":"/2018-05-12--Three-way-handshake-in-TCP-&-ACK-and-SYN-flood-attack/"},"frontmatter":{"title":"Three-way handshake in TCP & ACK and SYN flood attack"}},"next":{"fields":{"slug":"/2018-05-29--Desperate-hacking-notes-for-tomorrow/"},"frontmatter":{"title":"Desperate hacking notes for tomorrow"}}}},"staticQueryHashes":["3128451518","426816048"]}