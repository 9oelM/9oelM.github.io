{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022-01-02--elasticpwn-how-to-find-and-collect-data-from-exposed-elasticsearch-and-kibana-instances/","result":{"data":{"site":{"siteMetadata":{"title":"Joel's dev blog","author":"Joel Mun","siteUrl":"https://joel.is-a.dev"}},"markdownRemark":{"id":"d1fc65e4-0d1b-5cd7-94e0-7f6bb0beb2cd","excerpt":"Your Elasticsearch and Kibana instances are open, and that’s a real problem I have been doing some serious research on the public exposure of Elasticsearch and…","html":"<h1 id=\"your-elasticsearch-and-kibana-instances-are-open-and-thats-a-real-problem\" style=\"position:relative;\">Your Elasticsearch and Kibana instances are open, and that’s a real problem<a href=\"#your-elasticsearch-and-kibana-instances-are-open-and-thats-a-real-problem\" aria-label=\"your elasticsearch and kibana instances are open and thats a real problem permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>I have been doing some serious research on the public exposure of Elasticsearch and Kibana instances recently, and here are a few of the reports I made, found to be valid. I’ve been enjoying it so much:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5dfa32a37278ac1a5f7c78deb4e090af/699b7/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.81081081081081%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnUlEQVQI1x3DTwvBYADAYV+aHOSglEmIkKWWdhD5BC5yUJKabPan9TrNn6ZwcHhn9v6Up55ccN4x27TYuwuEOcIeNAjHfTy9jW30uBodnq0yYm7iTcf4EwPH1LFWSxzX4yQEQRAQhiFSSnKvd4y4H3lEPmm3gtTyJI0iSb2AbJaIDhbiciO2tqT9Komu8R3WuGzXvJMPKEWWZf9KKX41wIZAXpFxlgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hackerone Kibana exposure report 1\"\n        title=\"hackerone Kibana exposure report 1\"\n        src=\"/static/5dfa32a37278ac1a5f7c78deb4e090af/fcda8/1.png\"\n        srcset=\"/static/5dfa32a37278ac1a5f7c78deb4e090af/12f09/1.png 148w,\n/static/5dfa32a37278ac1a5f7c78deb4e090af/e4a3f/1.png 295w,\n/static/5dfa32a37278ac1a5f7c78deb4e090af/fcda8/1.png 590w,\n/static/5dfa32a37278ac1a5f7c78deb4e090af/699b7/1.png 596w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 569px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/934c3f6540a4b29ccd05d6524da7f4ac/854dc/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoElEQVQI1wXBzQoBUQCAUU9nKY9gIfIGSnkJewsSFrMTmZRmwfzdGd1hrpkaNyUsEDsm6XNOYRENUCeXQ6aJ45g0TVFKobUmSRJkGHCQG3auTSo89F4Rqj3XqcG3WSFvN/i1qmQTg+PlSmEueyRnn220wzRNLMvCcRyE57EWAdIY8qyVuNfLvCpFsm6HpSew5zPccR/fGHHzV+TPB+/Phz9PxIQT0x5GugAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hackerone Kibana exposure report 2\"\n        title=\"hackerone Kibana exposure report 2\"\n        src=\"/static/934c3f6540a4b29ccd05d6524da7f4ac/854dc/2.png\"\n        srcset=\"/static/934c3f6540a4b29ccd05d6524da7f4ac/12f09/2.png 148w,\n/static/934c3f6540a4b29ccd05d6524da7f4ac/e4a3f/2.png 295w,\n/static/934c3f6540a4b29ccd05d6524da7f4ac/854dc/2.png 569w\"\n        sizes=\"(max-width: 569px) 100vw, 569px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 579px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bc14d9abd9ab8f0cdfeacdff018cd339/c08bc/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAo0lEQVQI1x3GPQ7BYACAYfdh7xUao8QJWCwOYDDaxCRxAHGDTjoIoRW/1ehXX9tBSUiDyNeF+HklpufJ9J0u08AgPh5w7QnuwMSfjBDj4f/h1iWQkpUnOLcbvMp5HtUi75JO0qozFzvWywVCCKSUZMxNj1lgECUJYa2Cyue4FDSuBY2bnsXrNLEdF8uy8O0xHCI+ccR3H/A8HbmrlDRNUUr9/QH0n4OB3IaZwwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hackerone Kibana exposure report 3\"\n        title=\"hackerone Kibana exposure report 3\"\n        src=\"/static/bc14d9abd9ab8f0cdfeacdff018cd339/c08bc/3.png\"\n        srcset=\"/static/bc14d9abd9ab8f0cdfeacdff018cd339/12f09/3.png 148w,\n/static/bc14d9abd9ab8f0cdfeacdff018cd339/e4a3f/3.png 295w,\n/static/bc14d9abd9ab8f0cdfeacdff018cd339/c08bc/3.png 579w\"\n        sizes=\"(max-width: 579px) 100vw, 579px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 472px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3935d55f7c7da5014acf020ce3cca11e/3c5de/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC9UlEQVQ4y5WTW2hcRRjHx0RfpChSqa1pq7Ta2CepeKm9CLaID6lSsWm0xDYWU6Ul0CS9SBBbkrSJtGlByIMg+uqLCL4qiPShSWM09+bmSps9STbJutnN2Tlnz5yZn5xL3BpasAM/Zuabb/7ff4YZYQA9lUBdaUJ1tqC+6YjobMG70oR39TO8jmjN5BYJmjGGezVh5TRuXzfy/deQLz+Os0ogHxY4L62mUP06btVO3MpXKRx9E7MwGwlqfW/BnO3i+5o5H9LXfibfehJ5oR7d1xVtXokx/2GlY7EcmLOSpObnuZXOsOjHCb4C7QeWIHAV9MvSwdj3MUpF+CrUEWElIKvBBiRgx+Mlon5RQy6eZ01EEPfvduTQi/JIfdmC1VxP6otPsS6cYrb9LLNtZ0JuN9eTbG1kpu1MuDbV0hCu5ztb8b++hPqqHfXtVUwmHR85b+O9+BjeWkHhKYG3UeBtKPZqYzyOUXHcKRPIgCcE8hmBnhyJBWUeZ1cZcpNAbn0QWV66gpKYO+elyOdKcbY+hHxW4LzwKDoxtixo4+xch3xa4JSX4Gx54D4oQW4WOM+vQidG73C4e33oMKjoBJX/L8GJ/nU4WnQotz2CXCOQ6+N7CXhSINfdhbI4L2BDFAvcFu/QdVAn9lOofAXv0G68Q7tQ7+3AO7wHt3Yfbm1FxEcVuMf24X6wB7dyO27Vjvgnbcc9shdt3So+7LSVZiljk13IkU1l+NuBzK+/oJuPo9rqURdPotobUJ9/jLn+U/jmtO+jDRFah0SC2jB+Y5y/eif4s/smia5hJoctxr77EaupkYVLzcy3nyN18Ryp82eZ/v6HsDiqgCm4IdEvir9eUCk5mWLx8nns6jdYOrYfWfsWsu4guYYa7FM15E9/iN1Yg336KNlPDpCvfZtC3QHcE+9SOP4O/thgURBjmOiZYOJaP3OD49zuHmKmb4xkzxDTPUNMXe8n2TWA1TNEqv8m073DJH8bYeaP0TB39vcRJsfnGUhI/gGDlOZTq2C3BQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Kibana and Elasticsearch exposure report 4\"\n        title=\"Kibana and Elasticsearch exposure report 4\"\n        src=\"/static/3935d55f7c7da5014acf020ce3cca11e/3c5de/4.png\"\n        srcset=\"/static/3935d55f7c7da5014acf020ce3cca11e/12f09/4.png 148w,\n/static/3935d55f7c7da5014acf020ce3cca11e/e4a3f/4.png 295w,\n/static/3935d55f7c7da5014acf020ce3cca11e/3c5de/4.png 472w\"\n        sizes=\"(max-width: 472px) 100vw, 472px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>But my enjoyment must be someone else’s pain. Literally thousands of Elasticsearch and Kibana instances are publicly exposed to the Internet. They are just up for grabs, and that is a really serious problem. Sometimes, even top renowned tech companies make mistakes about this, exposing their internal data exposed to the public. The nature of the data stored in these instances are sometimes quite sensitive and are never meant to be shared: be it phone numbers, email addresses, home addresses, names, credit card numbers, even (plaintext!) passwords, internal API logs, private user data specific to the service, and more and more. I’ve seen millions of such data through this journey, which I never expected.</p>\n<p>I honestly feel so sad for the users who have their data exposed to the public and probably don’t even know about that because it’s the developers who make mistakes, not them. I saw data from huge game studios, shopping malls, and even some of the biggest banks. It’s awful and I wanted to help fix that.</p>\n<p>But the staggering number of instances and <a href=\"https://www.elastic.co/blog/what-is-an-elasticsearch-index\">indices</a> make it is somewhat difficult to find and collect <strong>interesting, or ‘useful’ data</strong> from them, which may lead to being awarded of bug bounties. To quickly gather data and filter useful and interesting ones, I decided to craft a tool that would automate removing lot of garbage data that nobody is interested in and help discover interesting data instead.</p>\n<p>So here it is: <em><a href=\"https://github.com/9oelm/elasticpwn\">elasticpwn</a></em>.</p>\n<h1 id=\"elasticpwn-a-brief-overview\" style=\"position:relative;\"><code class=\"language-text\">elasticpwn</code>: a brief overview<a href=\"#elasticpwn-a-brief-overview\" aria-label=\"elasticpwn a brief overview permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>In this article, I will walk you through the general workflow of using <code class=\"language-text\">elasticpwn</code>. For the detailed explanation and full options, see <a href=\"https://github.com/9oelm/elasticpwn\">README</a>.</p>\n<p>Prerequisites: <code class=\"language-text\">docker-compose</code>, <code class=\"language-text\">go^1.17</code>, <a href=\"https://shodan.io\">Shodan</a> or <a href=\"https://binaryedge.io\">Binaryedge</a> account (free account available for both)</p>\n<ol>\n<li>\n<p>Install the tool</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">go install github.com/9oelM/elasticpwn/elasticpwn@latest</code></pre></div>\n</li>\n<li>\n<p>Get a list of URLs of publicly exposed Elasticsearch and Kibana instances from OSINT platforms like <a href=\"https://shodan.io\">shodan.io</a> or <a href=\"https://binaryedge.io\">binaryedge.io</a>. Here are some starter dorks:</p>\n<p>binaryedge: find publicly exposed elasticsearch instances in the US</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">elasticSearch AND country:\"US\" AND product:\"Elasticsearch REST API\"</code></pre></div>\n<p>shodan: find publicly exposed elasticsearch instances, excluding false positives</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">elasticsearch 200 -\"adminer_sid\" -\"MiniUPnPd\"</code></pre></div>\n<p>Process the urls so that they are in the form of something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">123.123.123.123:80\n124.124.124.124:443\n... and so on.</code></pre></div>\n<p>in a text file.</p>\n</li>\n<li>\n<p>Launch a local mongo server (you don’t have to use mongodb, but for the sake of this tutorial, I will just use it - you can also use <code class=\"language-text\">json</code> output option)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> https://raw.githubusercontent.com/9oelM/elasticpwn/main/docker-compose-mongo-only.yml <span class=\"token parameter variable\">-o</span> docker-compose-mongo-only.yml <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">docker-compose</span> <span class=\"token parameter variable\">-f</span> docker-compose-mongo-only.yml up <span class=\"token parameter variable\">-d</span></code></pre></div>\n</li>\n<li>\n<p>Run <code class=\"language-text\">elasticpwn</code> to collect data from the instances</p>\n<p>This will collect and analyse all possible data from the instances with multiple threads.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">elasticpwn elasticsearch <span class=\"token parameter variable\">-f</span> list_of_elasticsearch_instances.txt <span class=\"token parameter variable\">-murl</span> mongodb://root:example@172.17.0.1:27017/ <span class=\"token parameter variable\">-of</span> mongo <span class=\"token parameter variable\">-t</span> <span class=\"token number\">12</span></code></pre></div>\n</li>\n<li>\n<p>Generate a report</p>\n<p>This command will generate a directory called <code class=\"language-text\">/report</code> under CWD.</p>\n<p>There will be a lot of data, like really a lot, and you can’t just review them all unless there is some form of review system. So there goes the reason for the existence of report feature. By default, <code class=\"language-text\">elasticpwn</code> will do its best to find interesting data like email, password, api logs, etc using its built-in regex matching and show it in addition to basic information about an instance. Based on this data, you can skip uninteresting ones and only leave interesting ones.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">elasticpwn report generate <span class=\"token parameter variable\">-cn</span> elasticsearch <span class=\"token parameter variable\">-murl</span> mongodb://root:example@172.17.0.1:27017/</code></pre></div>\n</li>\n<li>\n<p>View the report</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">elasticpwn report view <span class=\"token parameter variable\">-d</span> ./path-to-report <span class=\"token parameter variable\">-p</span> <span class=\"token number\">9999</span></code></pre></div>\n</li>\n</ol>\n<p>Here’s a sample report page containing information about a single Elasticsearch endpoint:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f5890ef201e717efaab1a7f8c6c4a47c/97bfd/elasticpwn-report-sample.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 172.97297297297297%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAIAAAAblL1PAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADYklEQVRIx5WVi3LrJhCG9TDnnJ4mcSzrYiEQdxAg0MWWk7TT93+PjsBxO+2ZxJn5R7MCPna1LKuM834YJkJEfigBQMcaVFVTH0FTNWVZHxtQ5MXjw+7xaf/4sHt6et7t9rvd/iHamVJOClMc6ufngvOeEIEQJUR2HSNUOjdVVfPt228/fvye9P37z2T8/PmYtYBgLCFkXScgZE1DAKAAUIwVQhxClgxCNCGbgYlKBkI0U2qYppcQVmtnzizbZKT03p8pM96flfJSDsNworRXKgzuxLlhzGrtNjiE1ZhJ60BpT2lPiObcWjsTorcdueXcKuUJ0VIOxkyE6LiRyYSwIazOLdYtnNvEc261DoRorQPnWyyMmbSpiuNXWGl/Ov3h/dnaRQjHmKG0F2JwbqG0N2bi3ArhhHCU9lJexxkzWtus60QMVXWdiGngEPKuE5ybaEgIOUICIdG2W/IY6yFkcYplAGCEWNsSCGnbEgBw25K2JWXZ5Hn9oarMmHGe30JYp+nFmDmF9LHidzkpTdb3YZpevD+P46Xvx5SMj0WIFsJtCdM6TGOEw5dgmzyP4wavYbwYM31KJjFmMOaZMdOyvI3j5f6wE9x1dAs7hNX71fuzc8v98Oa5aTqEGIQUbUeF2xZXFSiK4x2qs+MRtS0FADcNqqq2qtqyBEXRfKrD4Zi1LcVYAoDfR49l2ZQliM+riuJmg38N1jHsjjdNlxymFXGL9HqN4lAci3Lz9u4DHA511mEpuI1FazBWlGpKNSNKsO0842Xa6hljSYnGWGntCVGUbhWe1XVb1zDPq6h6v6/2+zI942u5z6t9nMrz+nC4VnWebwsyzo0xs5TD7d7dxLmVcrB2Nv0kpRdy4NzcjgohnjHWO7ekq991AmOVlC4p53YYFmdnJYe4QL7PagjpFnbToLqGoOlizo/Pz0WM/HNlhCjvV6XC7brdo9ib1NZJxvGS+tud5Httsw02ZhLC3brfF2AIuVLBuaXvRymHr8EIcSGccycdm/udn/0PTGnvhmWeX4fh9J+jvgse3GmeX62dpfw67NwyjRfvzyl5X/Q8bJ5DuPRmTmkntMdYdZ385RFe29DN8zK/OftObv80fzr9ua5/GTP/n4+1fYWNtXMIa69DynbqzNP0uixvv+yKCf4b2AIH4+eO1XEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"elasticpwn-report-sample.png\"\n        title=\"elasticpwn-report-sample.png\"\n        src=\"/static/f5890ef201e717efaab1a7f8c6c4a47c/fcda8/elasticpwn-report-sample.png\"\n        srcset=\"/static/f5890ef201e717efaab1a7f8c6c4a47c/12f09/elasticpwn-report-sample.png 148w,\n/static/f5890ef201e717efaab1a7f8c6c4a47c/e4a3f/elasticpwn-report-sample.png 295w,\n/static/f5890ef201e717efaab1a7f8c6c4a47c/fcda8/elasticpwn-report-sample.png 590w,\n/static/f5890ef201e717efaab1a7f8c6c4a47c/efc66/elasticpwn-report-sample.png 885w,\n/static/f5890ef201e717efaab1a7f8c6c4a47c/97bfd/elasticpwn-report-sample.png 1078w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"elasticpwn-persisting-your-research\" style=\"position:relative;\"><code class=\"language-text\">elasticpwn</code>: persisting your research<a href=\"#elasticpwn-persisting-your-research\" aria-label=\"elasticpwn persisting your research permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><code class=\"language-text\">elasticpwn</code> also offers a way to store and retrieve the reviewed URLs, so that you don’t have to review the same URLs again with the same report page. It often becomes very confusing because some instances are quite similar and the number of the instances is just too large.</p>\n<p>All you need is a persistent mongo database and an additional installation of <code class=\"language-text\">elasticpwn-backend</code>.</p>\n<ol>\n<li>\n<p>Generate the report with <code class=\"language-text\">-dn</code> option:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># -dn should be the url where elasticpwn-backend will be hosted\nelasticpwn report generate -cn elasticsearch -murl mongodb://root:example@172.17.0.1:27017/ -dn http://localhost:9292</code></pre></div>\n</li>\n<li>\n<p>Install <code class=\"language-text\">elasticpwn-backend</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">go install github.com/9oelM/elasticpwn/report/elasticpwn-backend@latest</code></pre></div>\n</li>\n<li>\n<p>Launch it. You need to specify your persistent mongodb URI as <code class=\"language-text\">mongodbUri</code> option:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">elasticpwn-backend -mongodbUri=mongodb+srv://username:pw@somewhere.mongodb.net/default-collection-name?retryWrites=true&amp;w=majority -databaseCollectionName=elasticsearch_reviewed_urls -databaseName elasticpwn -port 9292\n\n2021/12/28 05:38:54 Connected to database\n2021/12/28 05:38:54 Inserting\n2021/12/28 05:38:54 Test url already created before\n[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.\n\n[GIN-debug] [WARNING] Running in \"debug\" mode. Switch to \"release\" mode in production.\n- using env:   export GIN_MODE=release\n- using code:  gin.SetMode(gin.ReleaseMode)\n\n[GIN-debug] GET    /ping                     --> main.PingHandler (4 handlers)\n[GIN-debug] GET    /urls                     --> main.GetUrlsHandlerGenerator.func1 (4 handlers)\n[GIN-debug] POST   /urls                     --> main.PostUrlsHandlerGenerator.func1 (4 handlers)\n[GIN-debug] DELETE /urls                     --> main.DeleteUrlsHandlerGenerator.func1 (4 handlers)\n[GIN-debug] Listening and serving HTTP on 0.0.0.0:9292</code></pre></div>\n</li>\n<li>\n<p>With the server turned on, view the report (probably in another shell):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">elasticpwn report view -d ./path-to-report -p 9999</code></pre></div>\n</li>\n</ol>\n<p>Then, the report should be available, and each time you hit the ‘review’ button either with the keyboard shortcut or a click, the URL will be saved in the database for you to come back later or filter out duplicates later. If you are consistently generating report - say per week - then persistent database probably the answer.</p>\n<h1 id=\"securing-your-elastic-stack\" style=\"position:relative;\">Securing your Elastic stack<a href=\"#securing-your-elastic-stack\" aria-label=\"securing your elastic stack permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>These are some really minimal steps to get your Elastic stack secured:</p>\n<ul>\n<li>set <code class=\"language-text\">xpack.security.enabled</code> as <code class=\"language-text\">true</code> if you are running an old version of the Elastic stack. One really good news is that this is going to be <code class=\"language-text\">true</code> by default in the newest versions. This will help protect lots of instances from being exposed to the world:\n<blockquote>\n<p>Currently, security features are disabled when operating on a basic or trial license when <code class=\"language-text\">xpack.security.enabled</code> has not been explicitly set to true. This behavior is now deprecated. In version 8.0.0, security features will be enabled by default for all licenses, unless explicitly disabled (by setting <code class=\"language-text\">xpack.security.enabled</code> to <code class=\"language-text\">false</code>).</p>\n</blockquote>\n</li>\n<li>set password: <code class=\"language-text\">bin/elasticsearch-setup-passwords interactive</code></li>\n<li>use <code class=\"language-text\">WWW-Authenticate</code> header to restrict access</li>\n<li>put the instances inside the private network and use VPN</li>\n<li>and so much more…</li>\n</ul>\n<p>Elastic has <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-cluster.html\">a detailed documentation</a> on security, so make sure you check it out if you are the guy who manages the Elastic stack in the company.</p>\n<h1 id=\"conclusion\" style=\"position:relative;\">Conclusion<a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>So far, we have looked at:</p>\n<ul>\n<li>the problem of data exposure from numerous Elasticsearch and Kibana instances</li>\n<li>how <code class=\"language-text\">elasticpwn</code> helps detect and analyse the exposed data</li>\n<li>simple ways to secure the Elastic stack</li>\n</ul>\n<p>Thank you, and your feedback is always appreciated.</p>","frontmatter":{"title":"elasticpwn: how to collect and analyse data from exposed Elasticsearch and Kibana instances","date":"January 02, 2022","keywords":null},"fields":{"readingTime":{"text":"6 min read"}}}},"pageContext":{"slug":"/2022-01-02--elasticpwn-how-to-find-and-collect-data-from-exposed-elasticsearch-and-kibana-instances/","previous":{"fields":{"slug":"/2021-09-17--set-up-multiple-monitors-on-optimus-laptop-running-kali-linux/","readingTime":{"text":"7 min read"}},"frontmatter":{"title":"Set up multiple monitors on Optimus laptop running Kali linux","tab":"post","tags":["kali","optimius","graphics"],"keywords":null}},"next":{"fields":{"slug":"/2022-01-06--find-the-shortest-palindrome-an-intensive-review-of-kmp(knuth-morris-pratt)-algorithm/","readingTime":{"text":"19 min read"}},"frontmatter":{"title":"Find the shortest palindrome: an intensive review of the KMP(Knuth–Morris–Pratt) algorithm","tab":"post","tags":["algorithm"],"keywords":null}}}},"staticQueryHashes":["3128451518","426816048"]}