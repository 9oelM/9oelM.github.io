<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/styles.9f2e20345ed17da42ed8.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}pre code{white-space:pre-wrap!important;white-space:-moz-pre-wrap!important;white-space:-pre-wrap!important;white-space:-o-pre-wrap!important;word-wrap:break-word!important}</style><meta name="generator" content="Gatsby 2.24.53"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#009688"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><title data-react-helmet="true">Extensive introduction to why and how you might want to use and test redux-observable | Joel&#x27;s dev blog</title><meta data-react-helmet="true" name="description" content="Problem I was struggling at my company trying to write some tests for RxJS operations.
Most of the network requests were managed by RxJS, and none of them were…"/><meta data-react-helmet="true" property="og:title" content="Extensive introduction to why and how you might want to use and test redux-observable"/><meta data-react-helmet="true" property="og:description" content="Problem I was struggling at my company trying to write some tests for RxJS operations.
Most of the network requests were managed by RxJS, and none of them were…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Joel Mun"/><meta data-react-helmet="true" name="twitter:title" content="Extensive introduction to why and how you might want to use and test redux-observable"/><meta data-react-helmet="true" name="twitter:description" content="Problem I was struggling at my company trying to write some tests for RxJS operations.
Most of the network requests were managed by RxJS, and none of them were…"/><link as="script" rel="preload" href="/webpack-runtime-d8ae758bf1037408280d.js"/><link as="script" rel="preload" href="/framework-b5b229d58c3c710d5429.js"/><link as="script" rel="preload" href="/app-06ff2ede40703d30e0fb.js"/><link as="script" rel="preload" href="/styles-2d82ac8e3afc0c213061.js"/><link as="script" rel="preload" href="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-8c2c0a496a06ce672a0f.js"/><link as="script" rel="preload" href="/cd7d5f864fc9e15ed8adef086269b0aeff617554-2b8d7ef7d02817694af9.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-28fb13911c773217cda0.js"/><link as="fetch" rel="preload" href="/page-data/2020-01-24--Fundamental-yet-extensive-introduction-to-why-and-how-you-might-want-to-use-redux-observable-for-async-actions/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3128451518.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/426816048.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:70rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">Joel&#x27;s dev blog</a></h3></header><main><h1>Extensive introduction to why and how you might want to use and test redux-observable</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem">January 24, 2020</p><div><h1>Problem</h1>
<p>I was struggling at my company trying to write some tests for RxJS operations.
Most of the network requests were managed by RxJS, and none of them were covered by tests. I wanted to write tests, but just did not know how to.</p>
<p>But I really just wanted to start from the basics - I mean, the really basics, including why, and how we might want to use <code class="language-text">redux-observable</code>.</p>
<h1>tl;dr</h1>
<p>If you want to hop straight into the source code, <a href="https://github.com/9oelM/redux-observable">here it is.</a></p>
<h1>First things first</h1>
<h2>What is reactive programming?</h2>
<blockquote>
<p><a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754#reactive-programming-is-programming-with-asynchronous-data-streams">Reactive programming is programming with asynchronous data streams.</a></p>
</blockquote>
<ul>
<li>Typical events are async event streams, and want to observe over them</li>
<li>You have useful functions to combine/create/filter those streams</li>
</ul>
<blockquote>
<p>A <strong>stream</strong> is a sequence of ongoing events ordered in time. It can emit three different things: a value (of some type), an error, or a “completed” signal. </p>
</blockquote>
<blockquote>
<p>We capture these emitted events only asynchronously, by <strong>defining a function that will execute when a value is emitted,</strong> another function when an error is emitted, and another function when ‘completed’ is emitted.</p>
</blockquote>
<p>So this is essentially going back to <a href="https://github.com/9oelM/frontend-interview#observer">the observer design pattern</a>.</p>
<h2>Why bother to use rxjs?</h2>
<h3>Abstraction.</h3>
<p>If you use RP, you don’t have to really worry about implementation details, because it gives you high level of abstraction layer. So you never have to bother with <code class="language-text">Promise</code>s and <code class="language-text">await</code> in javascript anymore. Just declaratively implement what you want to do, and that’s it.</p>
<h3>Async works made easier</h3>
<p>Nowadays async operations have become a common thing, beacuse you might need to handle UI interactions &#x26; tonnes of network requests. </p>
<p>So there’s a good chance that it is going to be a good fit for heavily network based application (both for frontend and backend).</p>
<h3>Lots of helper functions to simplify work declaratively</h3>
<p>You have dedicated helper functions to implement what you want to do, which otherwise you might do in a very complex way. Even if this does not fully come to your mind right now, you are going to notice it as you go through this article.</p>
<h2>Why bother to use it with Redux?</h2>
<p>Now we have a brief understanding of advantages of using RxJS. Now, we want to handle actions in Redux, but not all actions are synchronous. </p>
<p>For a simple example, I have wrote a simple application that fetches text from the server and shows it, like this:</p>
<p><img src="/421fc0f32fd5495ee252e8946c8844b6/1.gif" alt="simple application that fetches text from the server and shows it"> </p>
<blockquote>
<p>I assumed that you have a prior knowledge of some Typescript and React fundamentals including hooks.</p>
</blockquote>
<p>This is the project structure (omitted unimportant ones):</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">src
├── App.tsx
├── DummyTextRequestButton
│   └── DummyTextRequestButton.tsx
├── DummyTextViewer
│   └── DummyTextViewer.tsx
├── redux
│   ├── actions.ts
│   ├── constants.ts
│   ├── reducer.ts
│   ├── store.ts
│   └── types.ts</code></pre></div>
<h3>Redux-related things first</h3>
<p>In redux, as you know, we mainly have actions and reducers. I have created three types of actions:</p>
<ol>
<li><code class="language-text">StartRequestText</code>: I will <code class="language-text">dispatch</code> this right before <code class="language-text">fetch</code>ing from the dummy text API.</li>
<li><code class="language-text">FinishRequestText</code>: I will <code class="language-text">dispatch</code> this right after receiving the text.</li>
<li><code class="language-text">ErrorRequestText</code>: I will <code class="language-text">dispatch</code> this as soon as I encounter an error in the process described above.</li>
</ol>
<p>The above actions are implemented like this in <code class="language-text">actions.ts</code>:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Constants <span class="token keyword">as</span> <span class="token constant">C</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">StartRequestTextAction</span> <span class="token keyword">extends</span> <span class="token class-name">Action<span class="token operator">&lt;</span><span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span><span class="token operator">></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">startRequestText</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">StartRequestTextAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">FinishRequestTextAction</span> <span class="token keyword">extends</span> <span class="token class-name">Action<span class="token operator">&lt;</span><span class="token keyword">typeof</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">FINISH_REQUEST_TEXT</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
  text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">finishRequestText</span><span class="token operator">:</span> <span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">FinishRequestTextAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">FINISH_REQUEST_TEXT</span><span class="token punctuation">,</span>
  text<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ErrorRequestTextAction</span> <span class="token keyword">extends</span> <span class="token class-name">Action<span class="token operator">&lt;</span><span class="token keyword">typeof</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">ERROR_REQUEST_TEXT</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
  errorMsg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">errorRequestText</span><span class="token operator">:</span> <span class="token punctuation">(</span>errorMsg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">ErrorRequestTextAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">ERROR_REQUEST_TEXT</span><span class="token punctuation">,</span>
  errorMsg<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>And I simply defined some action types in <code class="language-text">constants.ts</code>:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">enum</span> Constants <span class="token punctuation">{</span>
  <span class="token constant">START_REQUEST_TEXT</span> <span class="token operator">=</span> <span class="token string">'START_REQUEST_TEXT'</span><span class="token punctuation">,</span>
  <span class="token constant">FINISH_REQUEST_TEXT</span> <span class="token operator">=</span> <span class="token string">'FINISH_REQUEST_TEXT'</span><span class="token punctuation">,</span>
  <span class="token constant">ERROR_REQUEST_TEXT</span> <span class="token operator">=</span> <span class="token string">'ERROR_REQUEST_TEXT'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Putting them into <code class="language-text">reducer.ts</code> is not difficult at all.
We just have to update the state for each different action.
You can see that I’m updating <code class="language-text">isLoading</code>, <code class="language-text">text</code>, and <code class="language-text">errorMsg</code> individually according to each <code class="language-text">type</code> of an <code class="language-text">action</code>:</p>
<p><code class="language-text">reducer.ts</code></p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Reducer<span class="token punctuation">,</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> SimpleTextState<span class="token punctuation">,</span> AllActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Constants <span class="token keyword">as</span> <span class="token constant">C</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> simpleTextReducer<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span>SimpleTextState<span class="token punctuation">,</span> AllActions<span class="token operator">></span> <span class="token operator">=</span>
  <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> isLoading<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>state<span class="token punctuation">,</span>
          isLoading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">FINISH_REQUEST_TEXT</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>state<span class="token punctuation">,</span>
          text<span class="token operator">:</span> action<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
          isLoading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">ERROR_REQUEST_TEXT</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>state<span class="token punctuation">,</span>
          errorMsg<span class="token operator">:</span> action<span class="token punctuation">.</span>errorMsg<span class="token punctuation">,</span>
          isLoading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token keyword">const</span> reducers<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span>RootState<span class="token operator">></span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">combineReducers</span><span class="token generic class-name"><span class="token operator">&lt;</span>RootState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  simpleText<span class="token operator">:</span> simpleTextReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducers<span class="token punctuation">;</span></code></pre></div>
<p>Again, not so much in <code class="language-text">store.ts</code>. Just combine reducers (although we just have one, which is not usual in production envrionments) and configure redux devtools extension, and create store.</p>
<p><code class="language-text">store.ts</code></p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers<span class="token punctuation">,</span> createStore<span class="token punctuation">,</span> Action<span class="token punctuation">,</span> Reducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducers <span class="token keyword">from</span> <span class="token string">'./reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SimpleTextState<span class="token punctuation">,</span> RootState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Constants <span class="token keyword">as</span> <span class="token constant">C</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>State<span class="token punctuation">,</span> AllActions<span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  reducers<span class="token punctuation">,</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION__ <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION__</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span></code></pre></div>
<p>And I defined the types we need in <code class="language-text">types.ts</code>:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actions <span class="token keyword">from</span> <span class="token string">"./actions"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ActionType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typesafe-actions'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">AllActions</span> <span class="token operator">=</span> ActionType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> actions<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RootState</span> <span class="token punctuation">{</span>
  simpleText<span class="token operator">:</span> SimpleTextState<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">SimpleTextState</span> <span class="token punctuation">{</span>
  text<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  errorMsg<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  isLoading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">App.tsx</code>
In the parent component, we just want to show two things: the button and the text.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./redux/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> DummyTextRequestButton <span class="token keyword">from</span> <span class="token string">'./DummyTextRequestButton/DummyTextRequestButton'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> DummyTextViewer <span class="token keyword">from</span> <span class="token string">'./DummyTextViewer/DummyTextViewer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>DummyTextRequestButton <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>DummyTextViewer <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">DummyTextRequestButton.tsx</code></p>
<p>In this component, we have the logic of dispatching all of the actions we have defined earlier.
You have to recognize that we want to port the logic in <code class="language-text">handleClick</code> to <code class="language-text">redux-observable</code> later, because right now it’s not reactive at all.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">FC</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Dispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> startRequestText<span class="token punctuation">,</span> errorRequestText<span class="token punctuation">,</span> finishRequestText <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../redux/actions'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> DummyTextRequestButton<span class="token operator">:</span> <span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch<span class="token operator">:</span> Dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token constant">REQUEST_URL</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'https://baconipsum.com/api/?type=meat?paras=200'</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">startRequestText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> response<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> Error <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">REQUEST_URL</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resp<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> resp<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">=></span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span>response <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token operator">?</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">errorRequestText</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">finishRequestText</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>button 
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> backgroundColor<span class="token operator">:</span> <span class="token string">'grey'</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
      onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span>
    <span class="token operator">></span>
      Click me to request dummy text
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DummyTextRequestButton<span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">DummyTextViewer.tsx</code>
This component consumes the redux state. Shows error, text, or loading based on the state.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">FC</span><span class="token punctuation">,</span> ReactNode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../redux/types'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> DummyTextViewer<span class="token operator">:</span> <span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    simpleText<span class="token operator">:</span> <span class="token punctuation">{</span>
      text<span class="token punctuation">,</span> errorMsg<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token operator">:</span> RootState <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> RootState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> textViewer<span class="token operator">:</span> ReactNode <span class="token operator">=</span> errorMsg <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>oops<span class="token punctuation">,</span> there was an error<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span> <span class="token operator">:</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> dummyTextViewer<span class="token operator">:</span> ReactNode <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> isLoading <span class="token operator">?</span> 
    <span class="token punctuation">(</span><span class="token operator">&lt;</span>p<span class="token operator">></span>loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">:</span> textViewer<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>section<span class="token operator">></span>
      <span class="token punctuation">{</span>dummyTextViewer<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DummyTextViewer<span class="token punctuation">;</span></code></pre></div>
<h3>With RxJS and redux-observable?</h3>
<p>First of all, we are going to introduce relevant modules to our project:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> i --save redux-devtools-extension redux-observable rxjs</code></pre></div>
<p>Then we want to get rid of somewhat complex logic inside <code class="language-text">DummyTextRequestButton.tsx</code>:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">FC</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Dispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> startRequestText <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../redux/actions'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> DummyTextRequestButton<span class="token operator">:</span> <span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch<span class="token operator">:</span> Dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/** Now we just want to trigger the first single action */</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">startRequestText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>button 
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> backgroundColor<span class="token operator">:</span> <span class="token string">'grey'</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
      onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span>
    <span class="token operator">></span>
      Click me to request dummy text
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DummyTextRequestButton<span class="token punctuation">;</span></code></pre></div>
<p>We can do it like above because we are going to port our logic to <code class="language-text">redux-observable</code>.</p>
<p>Then, we are going to create something called <code class="language-text">epics.ts</code> inside <code class="language-text">redux</code> folder:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Epic<span class="token punctuation">,</span> ofType<span class="token punctuation">,</span> combineEpics <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"redux-observable"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> catchError<span class="token punctuation">,</span> mergeMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fromFetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/fetch'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Constants <span class="token keyword">as</span> <span class="token constant">C</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState<span class="token punctuation">,</span> AllActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./types"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actions <span class="token keyword">from</span> <span class="token string">"./actions"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> startRequestTextEpic<span class="token operator">:</span> Epic<span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> AllActions<span class="token punctuation">,</span> RootState<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>action$<span class="token punctuation">,</span> _store<span class="token punctuation">)</span> <span class="token operator">=></span>
  action$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">ofType</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token constant">REQUEST_URL</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'https://baconipsum.com/api/?type=meat?paras=200'</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> sendRequest$ <span class="token operator">=</span> <span class="token function">fromFetch</span><span class="token punctuation">(</span><span class="token constant">REQUEST_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> sendRequest$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">mergeMap</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span>resp<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">from</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">finishRequestText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">errorRequestText</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rootEpic<span class="token operator">:</span> Epic<span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> AllActions<span class="token punctuation">,</span> RootState<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">combineEpics</span><span class="token punctuation">(</span>
  startRequestTextEpic<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> rootEpic<span class="token punctuation">;</span></code></pre></div>
<p>I know, I know. Lots of things going on here, but let me explain one by one.</p>
<blockquote>
<p>An <strong>epic</strong> is really just something that listens to a redux action and outputs other actions accordingly.</p>
</blockquote>
<p>So how is that done in the code above? We can see that <code class="language-text">startRequestTextEpic</code> is listening to an action of the type called <code class="language-text">C.START_REQUEST_TEXT</code> only. So this code, won’t get executed it any other actions are dispatched from redux.</p>
<p>Ok, forget about <code class="language-text">mergeMap</code> for now and then let’s go on for now. We can see that we are using RxJS’s own <code class="language-text">fetch</code> method called <code class="language-text">fromFetch</code>, which essentially just makes <code class="language-text">fetch</code> into an observable.</p>
<p>Now you process the response from <code class="language-text">fetch</code>, and the <code class="language-text">text</code> inside the response would be a payload to <code class="language-text">finishRequestText</code> action.</p>
<p>Otherwise, if you have an error while <code class="language-text">fetch</code>ing, the error is going to be caught and will dispatch <code class="language-text">errorRequestText</code> action.</p>
<p>In this way, we have successfully ported our implementation in <code class="language-text">handleClick</code> to inside an epic, and all that’s left for we us to do is actually configure a few things in <code class="language-text">store.ts</code> to be able to use <code class="language-text">redux-observable</code> in our project:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> applyMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createEpicMiddleware<span class="token punctuation">,</span> Epic <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-observable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> composeWithDevTools <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-devtools-extension'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> reducers <span class="token keyword">from</span> <span class="token string">'./reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState<span class="token punctuation">,</span> AllActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> rootEpic <span class="token keyword">from</span> <span class="token string">'./epics'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> epicMiddleware <span class="token operator">=</span> <span class="token function">createEpicMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> <span class="token function">composeWithDevTools</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// Specify name here, actionsBlacklist, actionsCreators and other options if needed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialRootState<span class="token operator">:</span> RootState <span class="token operator">=</span> <span class="token punctuation">{</span> simpleText<span class="token operator">:</span> <span class="token punctuation">{</span> isLoading<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>RootState<span class="token punctuation">,</span> AllActions<span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  reducers<span class="token punctuation">,</span>
  initialRootState<span class="token punctuation">,</span>
  <span class="token function">composeEnhancers</span><span class="token punctuation">(</span>
    <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>
      epicMiddleware<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

epicMiddleware<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>rootEpic <span class="token keyword">as</span> Epic<span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> AllActions<span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span></code></pre></div>
<p>So, after adding <code class="language-text">redux-observable</code>, now we have some benefits:</p>
<ol>
<li>Reactiveness. You can easily handle asynchronous actions and state updates in redux by reacting to actions being dispatched.</li>
<li>Separation of concerns. Now you don’t have to care about what to do after <code class="language-text">startRequestText</code> in <code class="language-text">DummyTextButton</code>, because all of the logics have been ported to <code class="language-text">startRequestTextEpic</code>.</li>
<li>Great toolchains. Right now we have used just few functions from RxJS, but combination of many functions will make it easier to process your data streams.</li>
</ol>
<h3>Extending further by utilizing what RxJS has</h3>
<p>Now we have one little problem: when a user clicks on the button many times in such a short time, the request is going to be sent more than one time, which might be kind of useless, as shown in this gif:</p>
<p><img src="/f23377929cc31526a5b09dbe8a0a8414/2.gif" alt="Requests are sent more than one time unintendedly"></p>
<p>I clicked on the button three times, but actually what you all need is just a single request. So here’s what you can do:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Epic<span class="token punctuation">,</span> ofType<span class="token punctuation">,</span> combineEpics <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"redux-observable"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token keyword">of</span><span class="token punctuation">,</span> timer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> catchError<span class="token punctuation">,</span> mergeMap<span class="token punctuation">,</span> debounce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fromFetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/fetch'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Constants <span class="token keyword">as</span> <span class="token constant">C</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState<span class="token punctuation">,</span> AllActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./types"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actions <span class="token keyword">from</span> <span class="token string">"./actions"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> startRequestTextEpic<span class="token operator">:</span> Epic<span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> AllActions<span class="token punctuation">,</span> RootState<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>action$<span class="token punctuation">,</span> _store<span class="token punctuation">)</span> <span class="token operator">=></span>
  action$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">ofType</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token constant">REQUEST_URL</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'https://baconipsum.com/api/?type=meat?paras=200'</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> sendRequest$ <span class="token operator">=</span> <span class="token function">fromFetch</span><span class="token punctuation">(</span><span class="token constant">REQUEST_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> sendRequest$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">mergeMap</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span>resp<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">from</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">finishRequestText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">errorRequestText</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rootEpic<span class="token operator">:</span> Epic<span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> AllActions<span class="token punctuation">,</span> RootState<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">combineEpics</span><span class="token punctuation">(</span>
  startRequestTextEpic<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> rootEpic<span class="token punctuation">;</span></code></pre></div>
<p>We just added <code class="language-text">debounce</code>, and it is going to filter out only one action of type <code class="language-text">START_REQUEST_TEXT</code> for a second, which means even if you click on the button three times in a single second, the request is going to be sent only once, like in the gif below:</p>
<p><img src="/bc920a1f20fc783e2677d4fdc3137422/3.gif" alt="Requests are sent just one time"></p>
<p>Alternatively, what you would want better is actually <code class="language-text">switchMap</code>; It would cancel any pending request and switch to the last one:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token function">ofType</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token constant">REQUEST_URL</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'https://baconipsum.com/api/?type=meat?paras=200'</span><span class="token punctuation">;</span></code></pre></div>
<p><img src="/18611d4e6ff4780e0d043d7c0dde371e/4.gif" alt="The pending requests are cancelled, and only the last one is not"></p>
<p>Now, let’s say that you would have another button to show some other text, like this:</p>
<p><img src="/ec43e9315a2034e6e4ef9fd2784154e5/5.gif" alt="You have another button to show some other text"></p>
<p>Because we now have an additional UI, we need to handle one special case (we are not going to cover other cases, although there are many): <strong>you click on request dummy text button, but you change your mind to see hi instead</strong>. Then you would need to <strong>cancel and finish</strong> your action. </p>
<p>For the sake of simplicity, I’m not going to show the entire code but <code class="language-text">epics.ts</code> to demontrate that (you can still look into <a href="https://github.com/9oelM/redux-observable/tree/master/redux-observable">the entire codebase from the Github repository</a>):</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Epic<span class="token punctuation">,</span> ofType<span class="token punctuation">,</span> combineEpics <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"redux-observable"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token keyword">of</span><span class="token punctuation">,</span> race<span class="token punctuation">,</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> catchError<span class="token punctuation">,</span> mergeMap<span class="token punctuation">,</span> switchMap<span class="token punctuation">,</span> filter<span class="token punctuation">,</span> map<span class="token punctuation">,</span> take<span class="token punctuation">,</span> merge <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fromFetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/fetch'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Constants <span class="token keyword">as</span> <span class="token constant">C</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState<span class="token punctuation">,</span> AllActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./types"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">"./actions"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> startRequestTextEpic<span class="token operator">:</span> Epic<span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> AllActions<span class="token punctuation">,</span> RootState<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>action$<span class="token punctuation">,</span> store$<span class="token punctuation">)</span> <span class="token operator">=></span>
  action$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">ofType</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token constant">REQUEST_URL</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'https://baconipsum.com/api/?type=meat?paras=1000'</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> sendRequest$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">.</span>FinishRequestTextAction <span class="token operator">|</span> <span class="token constant">A</span><span class="token punctuation">.</span>ErrorRequestTextAction<span class="token operator">></span> <span class="token operator">=</span>
        <span class="token function">fromFetch</span><span class="token punctuation">(</span><span class="token constant">REQUEST_URL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
          <span class="token function">mergeMap</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>resp<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> 
              <span class="token keyword">from</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                  <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">finishRequestText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">errorRequestText</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

      <span class="token keyword">const</span> cancelRequest$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">.</span>FinishRequestTextAction<span class="token operator">></span> <span class="token operator">=</span> action$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">ofType</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">TOGGLE_HI_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> store$<span class="token punctuation">.</span>value<span class="token punctuation">.</span>simpleText<span class="token punctuation">.</span>isHiTextShown<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">finishRequestText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">take</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token function">race</span><span class="token punctuation">(</span>sendRequest$<span class="token punctuation">,</span> cancelRequest$<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rootEpic<span class="token operator">:</span> Epic<span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> AllActions<span class="token punctuation">,</span> RootState<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">combineEpics</span><span class="token punctuation">(</span>
  startRequestTextEpic<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> rootEpic<span class="token punctuation">;</span></code></pre></div>
<p>We now have two major parts: <code class="language-text">sendRequest$</code> and <code class="language-text">cancelRequest$</code>. In <code class="language-text">cancelRequest$</code> ovservable, we are going to force finish requesting text, because there is no need to request the text anymore if you have switched to see the <code class="language-text">hi</code> text.</p>
<p><code class="language-text">race</code> would take the job of cancelling out any other ongoing action if the other action is finished. It’s just like <code class="language-text">Promise.race</code> in javascript! So, let’s see this in gif:</p>
<p><img src="/f96e8bed5d17d151d373b5fceb3fe471/6.gif" alt="The network request will be cancelled if you switch to see the hi text"></p>
<h3>Checkpoint</h3>
<p>Do you now get why you would use redux-observable? It equips you with a nice set of tools to perform side-effects after actions are dispatched in redux.
Otherwise it should have been a great pain for you manage events like cancellation manually, in vanilla javascript.</p>
<p>But hey, we are not done yet. Let’s finish it with a guide to how to test these epics.</p>
<h2>Testing your epics</h2>
<h3>Method 1: Test output actions based on input actions.</h3>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> ActionsObservable<span class="token punctuation">,</span> StateObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-observable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">of</span><span class="token punctuation">,</span> Subject<span class="token punctuation">,</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> toArray <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> rxjs <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">FF</span> <span class="token keyword">from</span> <span class="token string">'rxjs/fetch'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> startRequestTextEpic <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./epics'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Constants <span class="token keyword">as</span> <span class="token constant">C</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState<span class="token punctuation">,</span> AllActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'startRequestTextEpic'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> initialState<span class="token operator">:</span> RootState<span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    initialState <span class="token operator">=</span> <span class="token punctuation">{</span> simpleText<span class="token operator">:</span> <span class="token punctuation">{</span> isLoading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isHiTextShown<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should dispatch finishRequestText if there is no error'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fakeFetchResponse<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'test response, hi'</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Surprisingly, jest supports mocking individual functions 
     * from modules like this in each different test
     */</span>
    <span class="token comment">// @ts-ignore: this is valid. See https://github.com/facebook/jest/issues/936#issuecomment-214556122</span>
    rxjs<span class="token punctuation">.</span>race <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>observables<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Observable<span class="token operator">&lt;</span>AllActions<span class="token operator">>></span><span class="token punctuation">)</span> <span class="token operator">=></span> observables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// @ts-ignore this is valid also</span>
    <span class="token constant">FF</span><span class="token punctuation">.</span>fromFetch <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span>fakeFetchResponse<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> action$ <span class="token operator">=</span> ActionsObservable<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ActionsObservable<span class="token operator">&lt;</span>AllActions<span class="token operator">></span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> state$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StateObservable<span class="token operator">&lt;</span>RootState<span class="token operator">></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> actualActions$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>AllActions<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">startRequestTextEpic</span><span class="token punctuation">(</span>action$<span class="token punctuation">,</span> state$<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> actualActionsArray<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>AllActions<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">await</span> actualActions$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> expectedActionsArray<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>AllActions<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">FINISH_REQUEST_TEXT</span><span class="token punctuation">,</span>
        text<span class="token operator">:</span> fakeFetchResponse<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actualActionsArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>expectedActionsArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Whoa, lots of things to go through, right? But basically, all we are doing are just:</p>
<ol>
<li><strong>Mocking functions from certain modules to make them work according to our purpose</strong>. We are mocking <code class="language-text">rxjs.race</code> and <code class="language-text">FF.fromFetch</code> because, for <code class="language-text">race</code>, we don’t want race won’t work well in a test environment and we can decide on which observable to emit, instead of depending on the code itself, and for <code class="language-text">fromFetch</code>, we don’t want to use real <code class="language-text">fetch</code> because it is going to take more time for no useful reason.</li>
<li><strong>Running the epic with initial action and state</strong>. The epic will run, and spit out another set of actions as a result.</li>
<li><strong>Testing the equality of the output actions with the expected</strong>. We just need to test if the epic gives expected set of actions.</li>
</ol>
<p>That’s pretty much it! But we need to test more, so why not simplify this process with a simple function?:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Epic <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-observable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ActionsObservable<span class="token punctuation">,</span> StateObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-observable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Subject<span class="token punctuation">,</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> toArray <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AllActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">RunEpicTestParams<span class="token operator">&lt;</span>ActionsUsed <span class="token keyword">extends</span> Action<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">,</span> RootState<span class="token operator">></span></span> <span class="token punctuation">{</span>
  epicToTest<span class="token operator">:</span> Epic<span class="token operator">&lt;</span>ActionsUsed<span class="token punctuation">,</span> ActionsUsed<span class="token punctuation">,</span> RootState<span class="token operator">></span><span class="token punctuation">;</span>
  inputActions<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ActionsUsed<span class="token operator">></span><span class="token punctuation">;</span>
  initialState<span class="token operator">:</span> RootState<span class="token punctuation">;</span>
  expectedActions<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ActionsUsed<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">runEpicTest</span><span class="token generic class-name"><span class="token operator">&lt;</span>ActionsUsed <span class="token keyword">extends</span> Action<span class="token punctuation">,</span> State<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  epicToTest<span class="token punctuation">,</span>
  inputActions<span class="token punctuation">,</span>
  initialState<span class="token punctuation">,</span>
  expectedActions<span class="token punctuation">,</span>
  done<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> RunEpicTestParams<span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> State<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputAction$ <span class="token operator">=</span> ActionsObservable<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token operator">...</span>inputActions<span class="token punctuation">)</span> <span class="token keyword">as</span> ActionsObservable<span class="token operator">&lt;</span>ActionsUsed<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> state$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StateObservable<span class="token operator">&lt;</span>State<span class="token operator">></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> actualActions$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>ActionsUsed<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">epicToTest</span><span class="token punctuation">(</span>inputAction$<span class="token punctuation">,</span> state$<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Observable<span class="token operator">&lt;</span>ActionsUsed<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> actualActionsArray<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>AllActions<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">await</span> actualActions$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">expect</span><span class="token punctuation">(</span>actualActionsArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>expectedActions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now, we can turn out test into:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'startRequestTextEpic'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> initialState<span class="token operator">:</span> RootState<span class="token punctuation">;</span>
  <span class="token keyword">let</span> inputActions<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>AllActions<span class="token operator">></span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    initialState <span class="token operator">=</span> <span class="token punctuation">{</span> simpleText<span class="token operator">:</span> <span class="token punctuation">{</span> isLoading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isHiTextShown<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    inputActions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should dispatch finishRequestText if there is no error'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fakeFetchResponse<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'test response, hi'</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Surprisingly, jest supports mocking individual functions 
     * from modules like this in each different test
     */</span>
    <span class="token comment">// @ts-ignore: this is valid. See https://github.com/facebook/jest/issues/936#issuecomment-214556122</span>
    rxjs<span class="token punctuation">.</span>race <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>observables<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Observable<span class="token operator">&lt;</span>AllActions<span class="token operator">>></span><span class="token punctuation">)</span> <span class="token operator">=></span> observables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// @ts-ignore this is valid also</span>
    <span class="token constant">FF</span><span class="token punctuation">.</span>fromFetch <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span>fakeFetchResponse<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token generic-function"><span class="token function">runEpicTest</span><span class="token generic class-name"><span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> RootState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      epicToTest<span class="token operator">:</span> startRequestTextEpic<span class="token punctuation">,</span>
      expectedActions<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">FINISH_REQUEST_TEXT</span><span class="token punctuation">,</span>
          text<span class="token operator">:</span> fakeFetchResponse<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      inputActions<span class="token punctuation">,</span>
      initialState<span class="token punctuation">,</span>
      done<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Much less boilerplate, right?</p>
<p>Now we can write out tests for other things as well, like this:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'startRequestTextEpic'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> initialState<span class="token operator">:</span> RootState<span class="token punctuation">;</span>
  <span class="token keyword">let</span> inputActions<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>AllActions<span class="token operator">></span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    initialState <span class="token operator">=</span> <span class="token punctuation">{</span> simpleText<span class="token operator">:</span> <span class="token punctuation">{</span> isLoading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isHiTextShown<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    inputActions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should dispatch finishRequestText if there is no error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Already covered above</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should dispatch errorRequestText if there is an error while fetching data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fakeErrorMessage<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'test error message, hi'</span><span class="token punctuation">;</span>
    <span class="token comment">// @ts-ignore</span>
    <span class="token constant">FF</span><span class="token punctuation">.</span>fromFetch <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>fakeErrorMessage<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token generic-function"><span class="token function">runEpicTest</span><span class="token generic class-name"><span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> RootState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      epicToTest<span class="token operator">:</span> startRequestTextEpic<span class="token punctuation">,</span>
      expectedActions<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">ERROR_REQUEST_TEXT</span><span class="token punctuation">,</span>
          errorMsg<span class="token operator">:</span> fakeErrorMessage<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      inputActions<span class="token punctuation">,</span>
      initialState<span class="token punctuation">,</span>
      done<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should dispatch finishRequestText earlier if TOGGLE_HI_TEXT is called in the middle'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    initialState <span class="token operator">=</span> <span class="token punctuation">{</span> simpleText<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span>initialState<span class="token punctuation">.</span>simpleText<span class="token punctuation">,</span> isHiTextShown<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// @ts-ignore</span>
    rxjs<span class="token punctuation">.</span>race <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>observables<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Observable<span class="token operator">&lt;</span>AllActions<span class="token operator">>></span><span class="token punctuation">)</span> <span class="token operator">=></span> observables<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generic-function"><span class="token function">runEpicTest</span><span class="token generic class-name"><span class="token operator">&lt;</span>AllActions<span class="token punctuation">,</span> RootState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      epicToTest<span class="token operator">:</span> startRequestTextEpic<span class="token punctuation">,</span>
      expectedActions<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">FINISH_REQUEST_TEXT</span><span class="token punctuation">,</span>
          text<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      inputActions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>inputActions<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">TOGGLE_HI_TEXT</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      initialState<span class="token punctuation">,</span>
      done<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now you’ve got to see all of your tests pass: </p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/41932aa437b7d0d81dd007703e6a87f6/85e74/7.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABHElEQVQoz41Ry1LCQBBcIyGgovg8cKCs4qRICJCQzQsCsXyUVln+gP//F+3MbJaicoFDb2Ymsz3dO8r/HWH194j7PIQ7LdCZZbiKSzzkb+gtS/T1hmo51HN0HNpBhGud4jbd4iapiGyDu+xV4BF5Z54LoTtNCQlOJxoOoeWb2IJzris1puMphBovccJ4ieEQVB3bZgtnYmta+jh39ogVJ94swUW4wtmCUdRxIQ2sjJUahelugI3dOuYB7ECxipYfwwsyucjfLtmUeC/n5p1N36hx5K4lNP/pDc307twshJvcRpNMPnYpw+oLo/cf2ep5bXWw/pCcl9HXW1zStu07H8Sg/MSw+kYvWkuBCYWMbLaDVCwzsTw4K2gSNGr/C/nlT8KKC2wAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="All of your tests pass"
        title="All of your tests pass"
        src="/static/41932aa437b7d0d81dd007703e6a87f6/fcda8/7.png"
        srcset="/static/41932aa437b7d0d81dd007703e6a87f6/12f09/7.png 148w,
/static/41932aa437b7d0d81dd007703e6a87f6/e4a3f/7.png 295w,
/static/41932aa437b7d0d81dd007703e6a87f6/fcda8/7.png 590w,
/static/41932aa437b7d0d81dd007703e6a87f6/efc66/7.png 885w,
/static/41932aa437b7d0d81dd007703e6a87f6/c83ae/7.png 1180w,
/static/41932aa437b7d0d81dd007703e6a87f6/85e74/7.png 1436w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h3>Method 2: Use marble testing</h3>
<p>Previously, we’ve only used some basic methods to test epics. Using marble tests would allow you to focus more on <em>when</em> things happen.</p>
<p>If you are not familiar with the marble diagrams, please refer to <a href="http://reactivex.io/documentation/observable.html">ReactiveX’s explanation on marble diagrams</a>. Alternatively, there are many other good resources out on the web.</p>
<p>For the marble syntax, refer to <a href="https://rxjs-dev.firebaseapp.com/guide/testing/marble-testing#marble-syntax">rxjs API docs</a>.</p>
<h4>Hot vs Cold observables</h4>
<p>There was a great article on Medium that simplified the definition of hot and cold observables, <a href="https://medium.com/@bencabanes/marble-testing-observable-introduction-1f5ad39231c#f123">so I excerpted the definitions from it</a>. (Or look at <a href="https://rxjs-dev.firebaseapp.com/guide/testing/marble-testing">rxjs API doc</a>)</p>
<p>cold: begins subscription when the test begins. </p>
<blockquote>
<p><code class="language-text">cold(--a--b--|, { a: &#39;Hello&#39;, b: &#39;World&#39; })</code> → Emit ‘Hello’ at 30ms and ‘World’ at 60ms, complete at 90ms.</p>
</blockquote>
<p>hot: begins subscription at the point of caret.</p>
<blockquote>
<p><code class="language-text">hot(--^--a--b--|, { a: &#39;Hello&#39;, b: &#39;World&#39; })</code> → Subscription begins at point of caret, then emit ‘Hello’ at 30ms and ‘World’ at 60ms, complete at 90ms.</p>
</blockquote>
<h4>Testing events in relation to time</h4>
<p>What we couldn’t really answer using method 1 was something like ‘can actions be really be cancelled if there are multiple action inputs, because we are using <code class="language-text">switchMap</code>?’</p>
<p>Now because we have a control over time, this is totally possible. </p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">of</span><span class="token punctuation">,</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> rxjs <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">FF</span> <span class="token keyword">from</span> <span class="token string">'rxjs/fetch'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TestScheduler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/testing'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> startRequestTextEpic <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./epics'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Constants <span class="token keyword">as</span> <span class="token constant">C</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState<span class="token punctuation">,</span> AllActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ActionsObservable<span class="token punctuation">,</span> StateObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-observable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HotObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/internal/testing/HotObservable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StartRequestTextAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./actions'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> delay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ColdObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/internal/testing/ColdObservable'</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> initialState<span class="token operator">:</span> RootState<span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    initialState <span class="token operator">=</span> <span class="token punctuation">{</span> simpleText<span class="token operator">:</span> <span class="token punctuation">{</span> isLoading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isHiTextShown<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should dispatch finishRequestText if there is no error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> fakeFetchResponse<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'fake response'</span><span class="token punctuation">;</span>
      <span class="token comment">// @ts-ignore: this is valid. See https://github.com/facebook/jest/issues/936#issuecomment-214556122</span>
      rxjs<span class="token punctuation">.</span>race <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>observables<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Observable<span class="token operator">&lt;</span>AllActions<span class="token operator">>></span><span class="token punctuation">)</span> <span class="token operator">=></span> observables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// @ts-ignore this is valid also</span>
      <span class="token constant">FF</span><span class="token punctuation">.</span>fromFetch <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span>fakeFetchResponse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> testScheduler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestScheduler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>actual<span class="token punctuation">,</span> expected<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// somehow assert the two objects are equal</span>
        <span class="token comment">// e.g. with chai `expect(actual).deep.equal(expected)`</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// https://github.com/redux-observable/redux-observable/issues/620#issuecomment-466736543</span>
      testScheduler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hot<span class="token punctuation">,</span> cold<span class="token punctuation">,</span> expectObservable <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> actionInput$<span class="token operator">:</span> ColdObservable<span class="token operator">&lt;</span>StartRequestTextAction<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">cold</span><span class="token punctuation">(</span><span class="token string">'1ms -a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> action$<span class="token operator">:</span> ActionsObservable<span class="token operator">&lt;</span>AllActions<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActionsObservable</span><span class="token punctuation">(</span>actionInput$<span class="token punctuation">)</span> <span class="token keyword">as</span> ActionsObservable<span class="token operator">&lt;</span>AllActions<span class="token operator">></span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> stateInput$<span class="token operator">:</span> HotObservable<span class="token operator">&lt;</span>RootState<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">hot</span><span class="token punctuation">(</span><span class="token string">'-a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> initialState<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> state$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StateObservable</span><span class="token punctuation">(</span>stateInput$<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> output$ <span class="token operator">=</span> <span class="token function">startRequestTextEpic</span><span class="token punctuation">(</span>action$<span class="token punctuation">,</span> state$<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
      <span class="token function">expectObservable</span><span class="token punctuation">(</span>output$<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'1ms --a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">FINISH_REQUEST_TEXT</span><span class="token punctuation">,</span>
          text<span class="token operator">:</span> fakeFetchResponse<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">...</span></code></pre></div>
<p>This one is really basic; We request text, and for the sake of the test, we delay the response from <code class="language-text">fromFetch</code> by <code class="language-text">1</code>ms. Then we run <code class="language-text">START_REQUEST_TEXT</code>, and expect the output action to be <code class="language-text">FINISH_REQUEST_TEXT</code> after another <code class="language-text">1</code>ms elapses. Simple. Right?</p>
<p>But what about some more complex test, like actions being cancelled because of <code class="language-text">switchMap</code>?:</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should dispatch only one finishRequestText despite many startRequestText'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fakeFetchResponse<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'fake response'</span><span class="token punctuation">;</span>
    <span class="token comment">// @ts-ignore: this is valid. See https://github.com/facebook/jest/issues/936#issuecomment-214556122</span>
    rxjs<span class="token punctuation">.</span>race <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>observables<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Observable<span class="token operator">&lt;</span>AllActions<span class="token operator">>></span><span class="token punctuation">)</span> <span class="token operator">=></span> observables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// @ts-ignore this is valid also</span>
    <span class="token constant">FF</span><span class="token punctuation">.</span>fromFetch <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span>fakeFetchResponse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> testScheduler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestScheduler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>actual<span class="token punctuation">,</span> expected<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// somehow assert the two objects are equal</span>
      <span class="token comment">// e.g. with chai `expect(actual).deep.equal(expected)`</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toStrictEqual</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//                                12345   67890</span>
    <span class="token keyword">const</span> inputMarble<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span>  <span class="token string">'1ms -abc(d|)--------'</span>
    <span class="token comment">//                                12345   67890</span>
    <span class="token keyword">const</span> outputMarble<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'1ms -----   ----(d|)'</span>
                                                <span class="token comment">// ^ it is normal to have this parenthesis because </span>
                                                <span class="token comment">//   'complete' event and d are synchronous</span>
                                                <span class="token comment">//   this position is the 10th frame</span>

    <span class="token comment">// https://github.com/redux-observable/redux-observable/issues/620#issuecomment-466736543</span>
    testScheduler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hot<span class="token punctuation">,</span> cold<span class="token punctuation">,</span> expectObservable <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> actionInput$<span class="token operator">:</span> ColdObservable<span class="token operator">&lt;</span>StartRequestTextAction<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">cold</span><span class="token punctuation">(</span>inputMarble<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        b<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        c<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        d<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">START_REQUEST_TEXT</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> action$<span class="token operator">:</span> ActionsObservable<span class="token operator">&lt;</span>AllActions<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActionsObservable</span><span class="token punctuation">(</span>actionInput$<span class="token punctuation">)</span> <span class="token keyword">as</span> ActionsObservable<span class="token operator">&lt;</span>AllActions<span class="token operator">></span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> stateInput$<span class="token operator">:</span> HotObservable<span class="token operator">&lt;</span>RootState<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">hot</span><span class="token punctuation">(</span><span class="token string">'-a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> initialState<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> state$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StateObservable</span><span class="token punctuation">(</span>stateInput$<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> output$ <span class="token operator">=</span> <span class="token function">startRequestTextEpic</span><span class="token punctuation">(</span>action$<span class="token punctuation">,</span> state$<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token function">expectObservable</span><span class="token punctuation">(</span>output$<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>outputMarble<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        d<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token constant">FINISH_REQUEST_TEXT</span><span class="token punctuation">,</span>
          text<span class="token operator">:</span> fakeFetchResponse<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>In the above code, we are faking <code class="language-text">fromFetch</code> again, and this time it is going to get you a response after <code class="language-text">5</code>ms.
Now you decide to <code class="language-text">START_REQUEST_TEXT</code> four times just in <code class="language-text">4ms</code>, in a row, each for each <code class="language-text">1ms</code>.</p>
<p>Then what is supposed to happen is that all of <code class="language-text">a</code>, <code class="language-text">b</code>, <code class="language-text">c</code> get cancelled, because they are cancelled by the actions dispatched right after them, at the time <code class="language-text">fromFetch</code> has not returned a response yet.
This is what <code class="language-text">switchMap</code> exactly does. It will cancel other observables and only emit the most decently projected observable, which is <code class="language-text">d</code> (after <code class="language-text">5ms</code>).</p>
<p>So that’s basically it! Of course, we could again make an abstraction of this testing logic, just like we did for <code class="language-text">runEpicTest</code>, but too bad - I’m too tired right now, so I will leave that work left for you. :)</p>
<h1>Conclusion</h1>
<p>So far, we’ve covered:</p>
<ol>
<li>why you might want to use <code class="language-text">rxjs</code> and <code class="language-text">redux-observable</code> (maybe you could suggest more reasons in the comments section)</li>
<li>how you could replace <code class="language-text">redux</code> based code into a <code class="language-text">redux-observable</code> one</li>
<li>extensibility (benefits) of using <code class="language-text">redux-observable</code>, especially for a complex logic</li>
<li>two methods of how you can test your <code class="language-text">epic</code>s</li>
</ol>
<h2>Appendix</h2>
<p>Just some last words for you.</p>
<h3>Suspicion on ‘always a pass’</h3>
<p>Sometimes, it’s hard to know if your test is really working or just being passed because jest finishes tests earlier than the time you want. <a href="https://jestjs.io/docs/en/asynchronous">Make sure you use <code class="language-text">done</code></a>, and if you are still not sure, try to break the test by changing something like <code class="language-text">expect(...).toEqual(...)</code> to <code class="language-text">expect(...).not.toEqual(...)</code>. Then you should see something like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c83c82de1cd5fbac0ff66c857a02e2ef/133ae/8.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 115.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAADqElEQVQ4y5VVyZbbNhCkFoqLVms8nvGSOHZy8EikSAKERFKzj33LKQe//ED+/xM6VQ1xnu3nHHIoNdAEGo1GVSv4M7fyT1nL67KVcXUtUXmUF82jnHVPMnd3stjfywS+4MpJsPkBW+DTXhamkr++/ipf/34nQZof5NJey8v2UdbdZw1wfv1F1u2TBk/MtcTVUca7VsKilWHeyAjgnGMiLBqZGSer+iBBkOHnqpYBbI8h7XaPxQfd+C28r1Fw3egUNNg22NtKQGeKk6f2Rqb1rWbEMbMaYTOzmhSd2hAB++wYcKTZeT/nHAeaMhyxuZHI3EpY4or2ViaYT1DT3j/IWxlgXcCMaLNGMdx1J+Aw+oco7Dyv5QUe5+XOyBKW41cYT+GPs1rWOyuLzMhZbvDNyDyzas+xZn3yLeBLtlaCCzg/lqW8Kyr5HfaPqtSFCwSNsSDc1hosReAVfPPMH8Kgq9wHnGE8hW+S4dUHeH4tLuo0gV1vkC18E1wjLFnXO5TgAdd2EtcVrMX18Wh5hxJ0KMFRr8xHCa72eGVsjqpWZg6bLWhSdRKXjaTGSGItOOgktTUohCwQMLUGj+TntNPa4DG8nbtSghikPOtKWTVOlo2VtK7xYg4UsKCDAYFrtZyPUYrxjn7SzCnCwirBRzsebvjKuO6JAkoDhxcGuWf1PQ55kuXhASc/qKVvaZ2skc0SifRICqMiSO2dBAwSg3sJ6EEOpsrHG7U9yMnEHJWnKVQVlyS+88i8BCkEiiJgdlG+16uxniRnDP5Rvwzk4eXHLEKSvOz0oIQwHjpHQgEDMMte8L1mBxkO2f4c5C7x0+/fdg/SJ0I2CWXHgH1H2fwPPEfe+Dp8355+zMD9Z9b+GwNuvGOQe12OUacx6kTtDgESflQc1apeOWfXUe2ynkfd+5zABJKhhi92lfwC+VGKlxi/L0qVGiX4GnPK8U3hLfV+Bks/1746+eZAcInJWyy8BJfel5VqmvgAXdP3Ab6PwG+YX8DPBEJQhbqlvomIBCe5/ZXxk7E14arQ4xLzVa/lCnQAmZPaazmBtBJIj2LwLcuXwpeI1+Yro5vM6gb/IzdQA9het8BB5vsC2q6gkgKapRKgbeh7Ag1HFSRqKwXlRjlGldF5MEDKM1dBZgYoEQgfajaCUhvAKHfKSa9d6Joa57WpXeh4fNL1MHfaA7Rjj/m6vDJs5O4lPjzKwuFPq/38rGf+E65o3V7OD2hx0POiQiLIKj5pma3uX825kIDKdvUuAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Your tests start to fail"
        title="Your tests start to fail"
        src="/static/c83c82de1cd5fbac0ff66c857a02e2ef/fcda8/8.png"
        srcset="/static/c83c82de1cd5fbac0ff66c857a02e2ef/12f09/8.png 148w,
/static/c83c82de1cd5fbac0ff66c857a02e2ef/e4a3f/8.png 295w,
/static/c83c82de1cd5fbac0ff66c857a02e2ef/fcda8/8.png 590w,
/static/c83c82de1cd5fbac0ff66c857a02e2ef/efc66/8.png 885w,
/static/c83c82de1cd5fbac0ff66c857a02e2ef/c83ae/8.png 1180w,
/static/c83c82de1cd5fbac0ff66c857a02e2ef/133ae/8.png 1424w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>if your tests are still being passed, then there’s a problem.</p>
<h3>Shoudn’t I test how epic changes the state as well?</h3>
<p>No. Because epic is supposed to test how set of actions gives another set of actions. </p>
<p>You are going to test that in your tests for reducer, because reducer is actually where the action will change the state.</p>
<p>What epic really does is just until dispatching actions. It’s related to the state because it uses the state, but it does not directly modify the state. That’s the role of the reducer.</p>
<h3>Source code repository</h3>
<ul>
<li><a href="https://github.com/9oelM/redux-observable/tree/master/redux-only">redux implementation</a></li>
<li><a href="https://github.com/9oelM/redux-observable/tree/master/redux-observable">redux-observable implementation and tests</a></li>
</ul></div><hr style="margin-bottom:1.75rem"/><div style="display:flex"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDAf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABy7nSMycNUI5yDf/EABoQAQEAAwEBAAAAAAAAAAAAAAECAAMSBBH/2gAIAQEAAQUCKcJEdM/YiqC5hvZ3XqtNnSDn/8QAFhEAAwAAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/ASv/xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8BI//EACAQAAIBAwQDAAAAAAAAAAAAAAABAhExQRASISJRUmH/2gAIAQEABj8CpQcZXOz2vwVdj57DkxwXEY4Glm+n/8QAGxAAAgMBAQEAAAAAAAAAAAAAAAERITFBYYH/2gAIAQEAAT8hgUw8H+KVqHQvZJwmVzhuN3ufBm5YyHgQkhCf6Gg//9oADAMBAAIAAwAAABAQKHz/xAAYEQACAwAAAAAAAAAAAAAAAAAAARARUf/aAAgBAwEBPxBIrk//xAAZEQADAAMAAAAAAAAAAAAAAAAAAREQIVH/2gAIAQIBAT8Qbmi+ix//xAAdEAEAAgIDAQEAAAAAAAAAAAABABEhMUFRYXHB/9oACAEBAAE/EG07OyWDzfUTIQvQcUBt9YkDm7GPYqTeWIPe/wBmi62AQwsVa+YlES9/DggPKdTCvL2xUW0HqIqGsT//2Q==" alt="Joel Mun" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/1265356b9e6bab3ff8ccafeaca6d96b8/99438/profile-pic.jpg 1x,
/static/1265356b9e6bab3ff8ccafeaca6d96b8/aba1d/profile-pic.jpg 1.5x,
/static/1265356b9e6bab3ff8ccafeaca6d96b8/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/1265356b9e6bab3ff8ccafeaca6d96b8/99438/profile-pic.jpg 1x,
/static/1265356b9e6bab3ff8ccafeaca6d96b8/aba1d/profile-pic.jpg 1.5x,
/static/1265356b9e6bab3ff8ccafeaca6d96b8/b315d/profile-pic.jpg 2x" src="/static/1265356b9e6bab3ff8ccafeaca6d96b8/99438/profile-pic.jpg" alt="Joel Mun" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Joel Mun</strong>. Joel&#x27;s been interested in Javascript, Typescript, Assemblyscript, Rust, Dart, and React, Flutter, and more.<!-- --> <a href="https://github.com/9oelM">Go check him up on Github!</a><br/> <!-- -->Joel&#x27;s also got his own random thoughts journal (mostly in Korean).<a href="https://www.notion.so/9oelm/2acfc525c9964be080d218770e6b8431?v=a7970392a2c54d3b857db145ded4de9e">Check it out too if you are curious.</a></p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/2020-01-08--The-shortcuts-I-like/">← <!-- -->The shortcuts I like</a></li><li><a rel="next" href="/2020-05-14--NSD-bulbaek-review/">[개발자도 리뷰 할 수 있다] 낙성대 문기사불백 리뷰<!-- --> →</a></li></ul><div id="disqus_thread" identifier="48bd2e8d-9a74-5583-af50-fe0fd901f65e" title="Extensive introduction to why and how you might want to use and test redux-observable" url="https://9oelm.github.io/2020-01-24--Fundamental-yet-extensive-introduction-to-why-and-how-you-might-want-to-use-redux-observable-for-async-actions/"></div></main><footer>© Joel Mun <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-105275697-3', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2020-01-24--Fundamental-yet-extensive-introduction-to-why-and-how-you-might-want-to-use-redux-observable-for-async-actions/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-905013744daa67b74738.js"],"app":["/app-06ff2ede40703d30e0fb.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-e5cb9e0c77a823b86dc2.js"],"component---src-pages-404-js":["/component---src-pages-404-js-0559109825d05de6d257.js"],"component---src-pages-index-js":["/component---src-pages-index-js-e2f445bd6d7979186701.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-28fb13911c773217cda0.js"]};/*]]>*/</script><script src="/polyfill-905013744daa67b74738.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-28fb13911c773217cda0.js" async=""></script><script src="/cd7d5f864fc9e15ed8adef086269b0aeff617554-2b8d7ef7d02817694af9.js" async=""></script><script src="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-8c2c0a496a06ce672a0f.js" async=""></script><script src="/styles-2d82ac8e3afc0c213061.js" async=""></script><script src="/app-06ff2ede40703d30e0fb.js" async=""></script><script src="/framework-b5b229d58c3c710d5429.js" async=""></script><script src="/webpack-runtime-d8ae758bf1037408280d.js" async=""></script></body></html>